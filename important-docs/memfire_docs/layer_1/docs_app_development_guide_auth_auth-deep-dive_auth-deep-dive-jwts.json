{
  "url": "https://docs.memfiredb.com/docs/app/development_guide/auth/auth-deep-dive/auth-deep-dive-jwts/",
  "title": "第一部分:JWTS | MemFire Cloud在线文档",
  "depth": 1,
  "timestamp": "2025-08-12 17:35:40",
  "html": "<main class=\"page-content bg-transparent\">\n<div class=\"top-header d-print-none\" id=\"top-header\">\n<div class=\"header-bar d-flex justify-content-between\">\n<div class=\"d-flex align-items-center\">\n<a alt=\"HomePage\" aria-label=\"HomePage\" class=\"logo-icon me-3\" href=\"/\">\n<div class=\"small\">\n<!--?xml version=\"1.0\" encoding=\"UTF-8\"?-->\n<svg height=\"112px\" version=\"1.1\" viewbox=\"0 0 99 112\" width=\"99px\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n<title>MemFireDB备份 6</title>\n<defs>\n<lineargradient id=\"linearGradient-1\" x1=\"49.9999885%\" x2=\"49.9999885%\" y1=\"98.082503%\" y2=\"0.766550128%\">\n<stop offset=\"0%\" stop-color=\"#ED1C23\"></stop>\n<stop offset=\"100%\" stop-color=\"#FBAF3B\"></stop>\n</lineargradient>\n</defs>\n<g fill=\"none\" fill-rule=\"evenodd\" id=\"定稿\" stroke=\"none\" stroke-width=\"1\">\n<g id=\"MemFireDB备份-6\">\n<polygon fill=\"#F9AE7C\" id=\"Fill-1\" points=\"25.9728553 40.7912363 47.4268317 0.00591833831 1.15453123 26.7215251\"></polygon>\n<polygon fill=\"#F9AE7C\" id=\"Fill-3\" points=\"97.4213117 26.7267606 51.1285247 0.000910513587 72.4242993 40.8351686\"></polygon>\n<polygon fill=\"#F9904A\" id=\"Fill-5\" points=\"24.8347133 42.7618153 0.000455256793 28.682999 0.000455256793 82.1608764\"></polygon>\n<polygon fill=\"url(#linearGradient-1)\" id=\"Fill-7\" points=\"27.6634514 42.4662399 49.279044 109.05096 70.7296059 42.507213 49.2779058 1.3747617\"></polygon>\n<polygon fill=\"#F9904A\" id=\"Fill-9\" points=\"98.5660549 28.6951771 73.5622137 42.8047233 98.5660549 82.1719163\"></polygon>\n<polygon fill=\"#FB6D33\" id=\"Fill-13\" points=\"72.2987623 45.061545 50.7514582 111.900071 97.579172 84.8646465\"></polygon>\n<polygon fill=\"#FB6D33\" id=\"Fill-15\" points=\"26.1006687 45.0226206 0.987565799 84.8644188 47.8095888 111.898705\"></polygon>\n<path d=\"M60.0737516,38.507213 C59.3168872,35.669825 57.0462939,33.3514298 57.0462939,33.3514298 C57.0462939,33.3514298 57.0804382,35.8849338 56.2894295,37.513615 C55.4847631,39.1696116 53.8765685,40.3054773 53.8765685,40.3054773 C53.8765685,40.3054773 56.1016361,33.8840802 54.2715038,30.1247973 C52.0259496,25.5073552 49.1771803,23.3357803 49.1771803,23.3357803 C49.1771803,23.3357803 50.1070423,28.1319107 48.6240432,31.5065016 C47.1672215,34.8264618 42.8058614,36.7260208 40.7241997,38.7132167 C39.1865699,40.1791435 38.0814341,43.0711623 37.6068289,44.4847347 C37.5715465,44.5883056 37.560165,44.6918765 37.5533362,44.7943093 C37.584066,43.9816759 37.8890881,39.8024186 40.9654858,37.4293925 C43.8404325,35.2111538 41.2431925,30.3478731 41.2431925,30.3478731 C41.2431925,30.3478731 41.7212121,32.5638355 40.9939394,34.1401622 C40.2655285,35.7153507 38.7187936,36.5962726 38.0154218,38.259098 C37.3883056,39.7409589 37.5203301,44.1432921 37.5453692,44.8409731 C37.5453692,44.8591834 37.5476455,44.8762555 37.5476455,44.8921895 C37.5476455,44.9263338 37.5487836,44.9456822 37.5487836,44.9456822 L37.5487836,44.9115379 C37.5590269,45.2655001 37.7138142,45.6080808 37.9972116,45.8448143 L48.3713757,55.6442168 C48.8380139,56.0323232 49.5163466,56.0334614 49.9841229,55.6476312 L60.5938825,45.7105136 C60.9034571,45.4544316 61.0719021,45.0686015 61.0457249,44.6656992 C60.9546735,43.2282259 60.5699815,40.3692133 60.0737516,38.507213\" fill=\"#FFFFFF\" id=\"Fill-17\"></path>\n</g>\n</g>\n</svg>\n</div>\n<div class=\"big\">\n<svg height=\"20\" width=\"232\" xmlns=\"http://www.w3.org/2000/svg\"><defs><lineargradient id=\"a\" x1=\"50%\" x2=\"50%\" y1=\"98.083%\" y2=\".767%\"><stop offset=\"0%\" stop-color=\"#ED1C23\"></stop><stop offset=\"100%\" stop-color=\"#FBAF3B\"></stop></lineargradient></defs><g fill=\"none\" fill-rule=\"evenodd\"><path d=\"M78.622 12.384l1.596 21.94H77.49l-.847-14.154-8.98 15.523-4.899-15.53-4.416 14.162H55.6l7.085-21.871 5.712 17.174 10.224-17.244zm99.46.382l.324.01.454.036c.085.008.175.018.269.03l.61.096c1.09.203 2.518.644 3.883 1.596l.515.383-.46 3.694-.413-.62-.154-.195-.255-.285c-.765-.802-2.485-2.188-5.23-2.188-4.55 0-8.723 3.809-9.3 8.491-.287 2.311.334 4.469 1.755 6.077 1.342 1.517 3.257 2.354 5.39 2.354 2.606 0 4.58-1.225 5.606-2.04l.359-.3.424-.408.507-.552-.466 3.766-.093.06a12.622 12.622 0 01-4.577 1.842l-.629.1-.53.058-.418.027-.444.003c-2.918-.002-5.532-1.142-7.36-3.21-1.851-2.096-2.67-4.88-2.305-7.837.73-5.88 5.964-10.696 11.806-10.974l.732-.014zm18.174 9.018c1.724 0 3.344.713 4.443 1.956 1.101 1.248 1.59 2.88 1.377 4.596-.432 3.504-3.808 6.466-7.375 6.466-1.728 0-3.348-.715-4.45-1.96-1.096-1.242-1.583-2.864-1.377-4.563.44-3.52 3.818-6.495 7.382-6.495zm19.446.535l-1.486 12.02h-2.558l.16-1.292c-.936.93-2.462 1.755-4.173 1.755-1.318 0-2.48-.492-3.267-1.385-.804-.91-1.168-2.184-1.008-3.497l.9-7.274 2.597-.327-.914 7.402c-.101.785.084 1.466.525 1.968.49.552 1.27.845 2.25.845 1.526 0 3.3-1.155 3.51-2.873l.87-7.015 2.594-.327zm-63.587-.547c1.77 0 3.21.58 4.164 1.678 1.047 1.207 1.48 3.01 1.263 5.233l-.097.771h-9.914c.16 1.896 1.567 2.979 3.895 2.979 1.806 0 2.878-.434 3.868-.961l1.119-.623-.312 2.522-.106.06c-1.224.687-2.604 1.356-4.8 1.356-2.092 0-3.873-.708-5.006-1.992-.991-1.12-1.404-2.599-1.198-4.272.548-4.433 4.001-6.751 7.124-6.751zm-62.717 0c1.771 0 3.211.58 4.164 1.678 1.048 1.207 1.48 3.01 1.263 5.233l-.097.771h-9.914c.16 1.896 1.567 2.979 3.895 2.979 1.622 0 2.652-.35 3.563-.803l.594-.315.83-.466-.312 2.522-.105.06c-1.224.687-2.604 1.356-4.8 1.356-2.093 0-3.874-.708-5.007-1.992-.99-1.12-1.404-2.599-1.197-4.272.547-4.433 4-6.751 7.123-6.751zM231.476 12l-2.767 22.34h-2.556l.197-1.59c-1.104 1.191-2.882 2.021-4.471 2.021-1.781 0-3.24-.583-4.217-1.69-1.02-1.151-1.452-2.817-1.222-4.686.485-3.908 3.43-6.636 7.167-6.636 1.565 0 3.065.832 3.852 2.064l1.356-10.968 2.661-.855zm-42.07.002L186.64 34.34h-2.556l2.664-21.483 2.66-.854zm-56.632 1.268l-1.166 2.527h-9.586l-.85 6.867h6.627v.48h-.12l-.883 1.778v.24h-5.933l-1.138 9.163h-2.729l2.612-21.055h13.166zm2.715 9.038l-1.497 12.017h-2.559l1.455-11.722 2.601-.295zm-24.427-.537c1 0 1.93.427 2.616 1.204.84.95 1.224 2.29 1.053 3.677l-.955 7.673h-2.527l.922-7.445c.13-1.017-.027-1.81-.45-2.287-.326-.367-.815-.554-1.458-.554-1.954 0-3.178 1.346-3.332 2.613l-.955 7.673h-2.556l.922-7.445c.127-1.03-.024-1.826-.442-2.297-.319-.362-.801-.544-1.437-.544-1.522 0-3.3 1.166-3.516 2.901l-.912 7.385h-2.559l1.455-11.722 2.594-.295-.146 1.164c1.027-1.077 2.419-1.701 3.854-1.701 1.375 0 2.58.79 3.226 2.083.914-1.13 2.05-2.083 4.603-2.083zm29.487.532l-.206 1.73c1.082-.978 2.932-1.7 4.514-1.7h.269l-.271 2.282h-.214c-1.814 0-4.469.837-4.7 2.7l-.866 7.01h-2.558l1.45-11.693 2.582-.329zm55.47 1.865c-2.31 0-4.27 1.792-4.563 4.168-.144 1.145.15 2.196.824 2.957.64.725 1.586 1.126 2.656 1.126 2.292 0 4.241-1.78 4.532-4.14.146-1.169-.144-2.237-.821-3.003-.634-.715-1.567-1.108-2.628-1.108zm27.497-.029c-2.278 0-4.15 1.752-4.45 4.17-.149 1.187.137 2.255.8 3.006.611.692 1.526 1.076 2.57 1.076 2.294 0 4.173-1.743 4.468-4.143.152-1.21-.13-2.285-.79-3.033-.623-.704-1.52-1.076-2.598-1.076zm-134.356.045c-1.89 0-3.372 1.094-4.015 2.947h7.164a2.853 2.853 0 00-.71-1.956c-.574-.648-1.416-.991-2.439-.991zm62.715 0c-1.892 0-3.37 1.094-4.013 2.947h7.166a2.867 2.867 0 00-.713-1.956c-.573-.648-1.416-.991-2.44-.991zm-17.267-7.614c.919 0 1.706.748 1.754 1.668a1.587 1.587 0 01-1.603 1.692c-.917 0-1.704-.75-1.754-1.668a1.593 1.593 0 011.603-1.692z\" fill=\"#116\"></path><path d=\"M11.131 17.482L20.326.002.495 11.453zm30.621-6.028L21.912 0l9.127 17.5z\" fill=\"#F9AE7C\"></path><path d=\"M10.643 18.326L0 12.293v22.919z\" fill=\"#F9904A\"></path><path d=\"M11.856 18.2l9.264 28.536 9.193-28.519L21.119.59z\" fill=\"url(#a)\"></path><path d=\"M42.243 12.298l-10.716 6.047 10.716 16.872z\" fill=\"#F9904A\"></path><path d=\"M30.985 19.312l-9.234 28.645L41.82 36.371zm-19.799-.017L.423 36.37 20.49 47.957z\" fill=\"#FB6D33\"></path><path d=\"M25.746 16.503c-.324-1.216-1.298-2.21-1.298-2.21s.015 1.086-.324 1.784c-.345.71-1.034 1.197-1.034 1.197s.954-2.752.17-4.363c-.963-1.98-2.184-2.91-2.184-2.91s.398 2.056-.237 3.502c-.624 1.423-2.494 2.237-3.386 3.088-.659.629-1.132 1.868-1.336 2.474a.509.509 0 00-.023.133c.013-.349.144-2.14 1.463-3.157 1.232-.95.119-3.035.119-3.035s.205.95-.107 1.625c-.312.676-.975 1.053-1.277 1.766-.268.635-.212 2.522-.201 2.82v.023l.001.022v-.014a.54.54 0 00.193.4l4.446 4.2c.2.166.49.166.69.001l4.548-4.259a.535.535 0 00.193-.448c-.039-.616-.203-1.84-.416-2.639\" fill=\"#FFF\"></path></g></svg>\n</div>\n</a>\n<button class=\"btn btn-icon btn-soft\" id=\"close-sidebar\">\n<span class=\"material-icons size-20 menu-icon align-middle\">menu</span>\n</button>\n</div>\n<div class=\"d-flex align-items-center\">\n<ul class=\"list-unstyled mb-0\">\n</ul>\n<a class=\"btn btn-icon btn-default ms-4\" href=\"https://memfiredb.com/\" target=\"_blank\" type=\"button\">官网</a>\n<a class=\"btn btn-icon btn-default ms-4\" href=\"https://community.memfiredb.com/\" target=\"_blank\" type=\"button\">论坛</a>\n<a class=\"btn btn-icon btn-default ms-4\" href=\"https://cloud.memfiredb.com/auth/login\" target=\"_blank\" type=\"button\">登录</a>\n<button aria-label=\"Toggle user interface mode\" class=\"btn btn-icon btn-default ms-2\" id=\"mode\" type=\"button\">\n<span class=\"toggle-dark\">\n<svg fill=\"currentColor\" height=\"30\" viewbox=\"0 0 48 48\" width=\"30\" xmlns=\"http://www.w3.org/2000/svg\">\n<title>Enable dark mode</title>\n<path d=\"M24 42q-7.5 0-12.75-5.25T6 24q0-7.5 5.25-12.75T24 6q.4 0 .85.025.45.025 1.15.075-1.8 1.6-2.8 3.95-1 2.35-1 4.95 0 4.5 3.15 7.65Q28.5 25.8 33 25.8q2.6 0 4.95-.925T41.9 22.3q.05.6.075.975Q42 23.65 42 24q0 7.5-5.25 12.75T24 42Zm0-3q5.45 0 9.5-3.375t5.05-7.925q-1.25.55-2.675.825Q34.45 28.8 33 28.8q-5.75 0-9.775-4.025T19.2 15q0-1.2.25-2.575.25-1.375.9-3.125-4.9 1.35-8.125 5.475Q9 18.9 9 24q0 6.25 4.375 10.625T24 39Zm-.2-14.85Z\"></path>\n</svg>\n</span>\n<span class=\"toggle-light\">\n<svg fill=\"currentColor\" height=\"30\" viewbox=\"0 0 48 48\" width=\"30\" xmlns=\"http://www.w3.org/2000/svg\">\n<title>Enable light mode</title>\n<path d=\"M24 31q2.9 0 4.95-2.05Q31 26.9 31 24q0-2.9-2.05-4.95Q26.9 17 24 17q-2.9 0-4.95 2.05Q17 21.1 17 24q0 2.9 2.05 4.95Q21.1 31 24 31Zm0 3q-4.15 0-7.075-2.925T14 24q0-4.15 2.925-7.075T24 14q4.15 0 7.075 2.925T34 24q0 4.15-2.925 7.075T24 34ZM3.5 25.5q-.65 0-1.075-.425Q2 24.65 2 24q0-.65.425-1.075Q2.85 22.5 3.5 22.5h5q.65 0 1.075.425Q10 23.35 10 24q0 .65-.425 1.075-.425.425-1.075.425Zm36 0q-.65 0-1.075-.425Q38 24.65 38 24q0-.65.425-1.075.425-.425 1.075-.425h5q.65 0 1.075.425Q46 23.35 46 24q0 .65-.425 1.075-.425.425-1.075.425ZM24 10q-.65 0-1.075-.425Q22.5 9.15 22.5 8.5v-5q0-.65.425-1.075Q23.35 2 24 2q.65 0 1.075.425.425.425.425 1.075v5q0 .65-.425 1.075Q24.65 10 24 10Zm0 36q-.65 0-1.075-.425-.425-.425-.425-1.075v-5q0-.65.425-1.075Q23.35 38 24 38q.65 0 1.075.425.425.425.425 1.075v5q0 .65-.425 1.075Q24.65 46 24 46ZM12 14.1l-2.85-2.8q-.45-.45-.425-1.075.025-.625.425-1.075.45-.45 1.075-.45t1.075.45L14.1 12q.4.45.4 1.05 0 .6-.4 1-.4.45-1.025.45-.625 0-1.075-.4Zm24.7 24.75L33.9 36q-.4-.45-.4-1.075t.45-1.025q.4-.45 1-.45t1.05.45l2.85 2.8q.45.45.425 1.075-.025.625-.425 1.075-.45.45-1.075.45t-1.075-.45ZM33.9 14.1q-.45-.45-.45-1.05 0-.6.45-1.05l2.8-2.85q.45-.45 1.075-.425.625.025 1.075.425.45.45.45 1.075t-.45 1.075L36 14.1q-.4.4-1.025.4-.625 0-1.075-.4ZM9.15 38.85q-.45-.45-.45-1.075t.45-1.075L12 33.9q.45-.45 1.05-.45.6 0 1.05.45.45.45.45 1.05 0 .6-.45 1.05l-2.8 2.85q-.45.45-1.075.425-.625-.025-1.075-.425ZM24 24Z\"></path>\n</svg>\n</span>\n</button>\n</div>\n</div>\n</div>\n<div class=\"container-fluid\">\n<div class=\"layout-spacing\">\n<div class=\"d-md-flex justify-content-between align-items-center\"></div>\n<div class=\"row flex-xl-nowrap\">\n<div class=\"docs-toc col-xl-3 d-xl-block\"><toc>\n<div class=\"fw-bold text-uppercase mb-2\">本页</div>\n\n</toc></div>\n<div class=\"docs-toc-mobile d-print-none d-xl-none\">\n<button aria-expanded=\"false\" class=\"btn-secondary dropdown-toggle\" data-bs-offset=\"0,0\" data-bs-toggle=\"dropdown\" id=\"toc-dropdown-btn\" type=\"button\">关于</button>\n</div>\n<div class=\"docs-content col-12 col-xl-9 mt-0\">\n<div class=\"mb-0 d-flex\">\n<h1 class=\"content-title mb-0\">\n                                                    第一部分:JWTS\n                                                    \n                                                </h1>\n</div>\n<div class=\"main-content\" data-bs-root-margin=\"0px 0px -65%\" data-bs-spy=\"scroll\" data-bs-target=\"#toc-mobile\" id=\"content\">\n<div data-prismjs-copy=\"\" data-prismjs-copy-error=\"\" data-prismjs-copy-success=\"\">\n<h3 id=\"关于\">关于 <a aria-hidden=\"true\" class=\"anchor\" href=\"#%e5%85%b3%e4%ba%8e\"><i class=\"material-icons align-middle\">link</i></a></h3><p>对JWTs的介绍以及它们在Supabase Auth中的使用方法</p>\n<h3 id=\"观察\">观察 <a aria-hidden=\"true\" class=\"anchor\" href=\"#%e8%a7%82%e5%af%9f\"><i class=\"material-icons align-middle\">link</i></a></h3><div classname=\"video-container\">\n<iframe allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen=\"\" frameborder=\"1\" src=\"https://www.youtube-nocookie.com/embed/v3Exg5YpJvE\"></iframe>\n</div>\n<h3 id=\"什么是json网络令牌jwts\">什么是JSON网络令牌（JWTs）？ <a aria-hidden=\"true\" class=\"anchor\" href=\"#%e4%bb%80%e4%b9%88%e6%98%afjson%e7%bd%91%e7%bb%9c%e4%bb%a4%e7%89%8cjwts\"><i class=\"material-icons align-middle\">link</i></a></h3><p>JWT是JSON对象，经过编码和签名，以字符串的形式发送。它们被分发给服务或网站的用户，用户随后可以向网站或服务展示JWT，作为他们有权访问某些内容的证明。</p>\n<p>当我们说 <code>编码</code>和 <code>签名</code>时，到底是什么意思？</p>\n<p>JSON对象开始时看起来像这样。</p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-js\" id=\"aeba16b\" tabindex=\"0\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  <span class=\"token string-property property\">\"sub\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0001\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Sam Vimes\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"iat\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1516239022</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"exp\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1518239022</span>\n<span class=\"token punctuation\">}</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<p><code>sub</code>是 <code>主题</code>，通常是用户的UUID。<code>name</code>是不言自明的，<code>iat</code>是创建令牌的Unix时间戳。许多JWT也会有一个<code>exp</code>，这是该令牌被设定为过期而不能再使用的日期。这些是你可能在JWT中发现的一些标准字段，但你几乎可以在其中存储任何你想要的东西，例如。</p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-js\" id=\"959ecd9\" tabindex=\"0\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  <span class=\"token string-property property\">\"sub\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0002\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Věra Hrabánková\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"iat\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1516239022</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"exp\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1518239022</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"theme\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string-property property\">\"primary\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"#D80C14\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string-property property\">\"secondary\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"#FFFFFF\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<p>只需注意，你在令牌中存储的数据越多，编码后的字符串就越长。</p>\n<p>当我们想把JWT发送给用户时，我们首先用一种算法对数据进行编码，如<code>HS256</code>。有许多库（和几种不同的算法）可以用来做这种编码/解码，例如<a href=\"https://www.npmjs.com/package/jsonwebtoken\" rel=\"external\" target=\"_blank\">jsonwebtoken<svg height=\"16\" viewbox=\"0 0 24 24\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M14 5c-.552 0-1-.448-1-1s.448-1 1-1h6c.552 0 1 .448 1 1v6c0 .552-.448 1-1 1s-1-.448-1-1v-3.586l-7.293 7.293c-.391.39-1.024.39-1.414 0-.391-.391-.391-1.024 0-1.414l7.293-7.293h-3.586zm-9 2c-.552 0-1 .448-1 1v11c0 .552.448 1 1 1h11c.552 0 1-.448 1-1v-4.563c0-.552.448-1 1-1s1 .448 1 1v4.563c0 1.657-1.343 3-3 3h-11c-1.657 0-3-1.343-3-3v-11c0-1.657 1.343-3 3-3h4.563c.552 0 1 .448 1 1s-.448 1-1 1h-4.563z\" fill=\"currentColor\"></path></svg></a>。我做了一个副本<a href=\"https://replit.com/@awalias/jsonwebtokens#index.js\" rel=\"external\" target=\"_blank\">这里<svg height=\"16\" viewbox=\"0 0 24 24\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M14 5c-.552 0-1-.448-1-1s.448-1 1-1h6c.552 0 1 .448 1 1v6c0 .552-.448 1-1 1s-1-.448-1-1v-3.586l-7.293 7.293c-.391.39-1.024.39-1.414 0-.391-.391-.391-1.024 0-1.414l7.293-7.293h-3.586zm-9 2c-.552 0-1 .448-1 1v11c0 .552.448 1 1 1h11c.552 0 1-.448 1-1v-4.563c0-.552.448-1 1-1s1 .448 1 1v4.563c0 1.657-1.343 3-3 3h-11c-1.657 0-3-1.343-3-3v-11c0-1.657 1.343-3 3-3h4.563c.552 0 1 .448 1 1s-.448 1-1 1h-4.563z\" fill=\"currentColor\"></path></svg></a>，所以你可以自己试试。签名的方法很简单。</p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-js\" id=\"c707499\" tabindex=\"0\"><code class=\"language-js\"><span class=\"token comment\">// from https://replit.com/@awalias/jsonwebtokens#index.js</span>\n<span class=\"token keyword\">let</span> token <span class=\"token operator\">=</span> jwt<span class=\"token punctuation\">.</span><span class=\"token function\">sign</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'Sam Vimes'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'some-secret'</span><span class=\"token punctuation\">)</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<p>而产生的字符串将看起来像这样。</p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-js\" id=\"498dd54\" tabindex=\"0\"><code class=\"language-js\">eyJhbGciOiJIUzI1NiJ9\n<span class=\"token punctuation\">.</span>eyJzdWIiOiIwMDAxIiwibmFtZSI6IlNhbSBWaW1lcyIsImlhdCI6MTUxNjIzOTAyMiwiZXhwIjoxNTE4MjM5MDIyfQ\n<span class=\"token punctuation\">.</span>zMcHjKlkGhuVsiPIkyAkB2rjXzyzJsMMgpvEGvGtjvA</code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<p>你会注意到，这个字符串实际上是由三个部分组成的，我们将逐一解决这个问题。</p>\n<p>第一段<code>eyJhbGciOiJIUzI1NiJ9</code>被称为 <code>头</code>，在解码时只是告诉我们用哪种算法来做编码。</p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-js\" id=\"4691df9\" tabindex=\"0\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  <span class=\"token string-property property\">\"alg\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"HS256\"</span>\n<span class=\"token punctuation\">}</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<p>第二段<code>eyJzdWIiOiIwMDAxIiwibmFtZSI6IlNhbSBWaW1lcyIsImlhdCI6MTUxNjIzOTAyMiwiZXhwIjoxNTE4MjM5MDIyfQ</code>包含我们的原始有效载荷。</p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-js\" id=\"e6fb5a4\" tabindex=\"0\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  <span class=\"token string-property property\">\"sub\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0001\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Sam Vimes\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"iat\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1516239022</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"exp\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1518239022</span>\n<span class=\"token punctuation\">}</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<p>最后一段<code>zMcHjKlkGhuVsiPIkyAkB2rjXzyzJsMMgpvEGvGtjvA</code>是签名本身，是网站或服务提供者用来验证某个用户发送的令牌是否合法的部分。它首先是通过对以下输入运行加密函数HS256产生的。</p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-js\" id=\"5e964f1\" tabindex=\"0\"><code class=\"language-js\"><span class=\"token constant\">HMACSHA256</span><span class=\"token punctuation\">(</span>\n  <span class=\"token function\">base64UrlEncode</span><span class=\"token punctuation\">(</span>header<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\".\"</span> <span class=\"token operator\">+</span>\n  <span class=\"token function\">base64UrlEncode</span><span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">&lt;</span>jwt_secret<span class=\"token operator\">&gt;</span>\n<span class=\"token punctuation\">)</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<p>你可以在<a href=\"https://jwt.io\" rel=\"external\" target=\"_blank\">https://jwt.io<svg height=\"16\" viewbox=\"0 0 24 24\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M14 5c-.552 0-1-.448-1-1s.448-1 1-1h6c.552 0 1 .448 1 1v6c0 .552-.448 1-1 1s-1-.448-1-1v-3.586l-7.293 7.293c-.391.39-1.024.39-1.414 0-.391-.391-.391-1.024 0-1.414l7.293-7.293h-3.586zm-9 2c-.552 0-1 .448-1 1v11c0 .552.448 1 1 1h11c.552 0 1-.448 1-1v-4.563c0-.552.448-1 1-1s1 .448 1 1v4.563c0 1.657-1.343 3-3 3h-11c-1.657 0-3-1.343-3-3v-11c0-1.657 1.343-3 3-3h4.563c.552 0 1 .448 1 1s-.448 1-1 1h-4.563z\" fill=\"currentColor\"></path></svg></a>上测试一下铸造你自己的代币。</p>\n<p>值得注意的是，任何拥有<code>jwt_secret</code>的人都可以创建新的令牌，也可以验证现有的令牌。更高级的JWT算法使用两个秘密：一个用于创建令牌，另一个用于验证签名令牌的有效性。</p>\n<p>你可能想知道为什么JWT突然间如此流行。答案是，随着微服务架构的大规模采用，我们遇到了这样一种情况：几个不同的微服务（API、网站、服务器等）想要轻松地验证一个用户是他们所说的人，或者换句话说，是一个 “登录 “用户。传统的会话令牌在这里没有用处，因为它们需要每个微服务维护一个当前有效的会话令牌的记录，或者在每次用户想要访问一个资源时查询一个中央数据库，以便检查会话令牌的有效性–效率确实很低。在这个意义上，基于JWT的认证是分散的，因为任何拥有 “jwt_secret “的人都可以验证一个令牌，而不需要访问一个中央数据库。</p>\n<p>注意：JWT的一个缺点是，它不像会话令牌那样可以轻易作废。如果JWT被泄露给恶意行为者，他们将能够在任何地方赎回它，直到到期日 - 当然，除非系统所有者更新<code>jwt_secret</code>（这当然会使_所有人的现有令牌失效）。</p>\n<h3 id=\"supabase中的jwts\">Supabase中的JWTs <a aria-hidden=\"true\" class=\"anchor\" href=\"#supabase%e4%b8%ad%e7%9a%84jwts\"><i class=\"material-icons align-middle\">link</i></a></h3><p>在Supabase中，我们为三个不同的目的发布JWTs：</p>\n<ol>\n<li><code>匿名密钥</code>:这个密钥用于绕过Supabase API网关，可以在你的客户端代码中使用。</li>\n<li><code>服务角色密钥</code>:此密钥具有超级管理员权限，可以绕过你的行级安全。不要把它放在你的客户端代码中。保持它的私密性。</li>\n<li><code>用户特定的JWTS</code>:这些是我们发给登录你的项目/服务/网站的用户的令牌。它相当于现代的会话令牌，可以被用户用来访问他们特定的内容或权限。</li>\n</ol>\n<p>这里的第一个令牌，即 <code>匿名钥匙</code>令牌，是供开发人员在想与Supabase数据库进行交互时与他们的API请求一起发送。</p>\n<p>假设你想读取一个表<code>colors</code>中所有行的名字。我们会提出这样一个请求：</p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-bash\" id=\"ccab89b\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"token function\">curl</span> <span class=\"token string\">'https://xscduanzzfseqszwzhcy.supabase.co/rest/v1/colors?select=name'</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYxNDIwNTE3NCwiZXhwIjoxOTI5NzgxMTc0fQ.-NBR1WnZyQGpRLdXJfgfpszoZ0EeE6KHatJsDPLIX8c\"</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<p>如果我们把这个令牌放到https://jwt.io，我们看到它被解码为：</p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-js\" id=\"a9b0948\" tabindex=\"0\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  <span class=\"token string-property property\">\"role\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"anon\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"iss\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"supabase\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"iat\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1614205174</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"exp\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1929781174</span>\n<span class=\"token punctuation\">}</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<p>这个JWT是由开发人员的Supabase令牌所特有的<code>jwt_secret</code>签署的（你可以在设置&gt;API页面下的仪表板上找到这个秘密和这个编码的 “anon key”），并且需要通过Supabase API网关并访问开发人员的项目。</p>\n<p>这个特定密钥的想法是，它可以安全地放入你的客户端，也就是说，如果你的终端用户看到这个密钥是可以的 - 但_只有在你首先启用行级安全的情况下，这是本系列的<a data-bs-delay='{\"hide\":300,\"show\":550}' data-bs-html=\"true\" data-bs-title=\"&lt;a href='/docs/app/development_guide/auth/auth-deep-dive/auth-row-level-security/'&gt;&lt;p&gt;深层探索&lt;/p&gt;&lt;strong&gt;第二部分:行级安全&lt;/strong&gt;&lt;br&gt;Supabase Auth Deep Dive第二部分 - 行级安全&lt;/a&gt;\" data-bs-toggle=\"tooltip\" href=\"/docs/app/development_guide/auth/auth-deep-dive/auth-row-level-security/\">第二部分</a> 的主题。</p>\n<p>第二个密钥，<code>服务角色密钥</code>，应该只在你自己的服务器或环境中使用，而不应该与终端用户共享。你可以使用这个令牌来做一些事情，比如批量插入数据。</p>\n<p><code>用户访问令牌</code>是当你呼叫时发出的JWT，例如:</p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-js\" id=\"6b6d825\" tabindex=\"0\"><code class=\"language-js\">supabase<span class=\"token punctuation\">.</span>auth<span class=\"token punctuation\">.</span><span class=\"token function\">signIn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">email</span><span class=\"token operator\">:</span> <span class=\"token string\">'lao.gimmie@gov.sg'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">password</span><span class=\"token operator\">:</span> <span class=\"token string\">'They_Live_1988!'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<p>这个令牌应该在<code>apikey</code>头之外作为<code>授权承载者</code>头传递。</p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-bash\" id=\"a2206f1\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"token function\">curl</span> <span class=\"token string\">'https://xscduanzzfseqszwzhcy.supabase.co/rest/v1/colors?select=name'</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYxNDIwNTE3NCwiZXhwIjoxOTI5NzgxMTc0fQ.-NBR1WnZyQGpRLdXJfgfpszoZ0EeE6KHatJsDPLIX8c\"</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJhdXRoZW50aWNhdGVkIiwiZXhwIjoxNjE1ODI0Mzg4LCJzdWIiOiIwMzM0NzQ0YS1mMmEyLTRhYmEtOGM4YS02ZTc0OGY2MmExNzIiLCJlbWFpbCI6InNvbWVvbmVAZW1haWwuY29tIiwiYXBwX21ldGFkYXRhIjp7InByb3ZpZGVyIjoiZW1haWwifSwidXNlcl9tZXRhZGF0YSI6bnVsbCwicm9sZSI6ImF1dGhlbnRpY2F0ZWQifQ.I-_oSsJamtinGxniPETBf-ezAUwDW2sY9bJIThvdX9s\"</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<p>你会注意到，这个令牌相当长，因为它包含了用户的具体信息，如:</p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-js\" id=\"a1efaf8\" tabindex=\"0\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  <span class=\"token string-property property\">\"aud\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"authenticated\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"exp\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1615824388</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"sub\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0334744a-f2a2-4aba-8c8a-6e748f62a172\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"email\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"d.l.solove@gmail.com\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"app_metadata\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"provider\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"email\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"user_metadata\"</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"role\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"authenticated\"</span>\n<span class=\"token punctuation\">}</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<p>现在你已经了解了什么是JWTs以及它们在Supabase中的用途，你可以探索如何将它们与行级安全相结合，开始限制对Postgres数据库中某些表、行和列的访问。<a data-bs-delay='{\"hide\":300,\"show\":550}' data-bs-html=\"true\" data-bs-title=\"&lt;a href='/docs/app/development_guide/auth/auth-deep-dive/auth-row-level-security/'&gt;&lt;p&gt;深层探索&lt;/p&gt;&lt;strong&gt;第二部分:行级安全&lt;/strong&gt;&lt;br&gt;Supabase Auth Deep Dive第二部分 - 行级安全&lt;/a&gt;\" data-bs-toggle=\"tooltip\" href=\"/docs/app/development_guide/auth/auth-deep-dive/auth-row-level-security/\">第二部分：行级安全</a></p>\n<h3 id=\"资源\">资源 <a aria-hidden=\"true\" class=\"anchor\" href=\"#%e8%b5%84%e6%ba%90\"><i class=\"material-icons align-middle\">link</i></a></h3><ul>\n<li>JWT debugger: <a href=\"https://jwt.io/\" rel=\"external\" target=\"_blank\">https://jwt.io/<svg height=\"16\" viewbox=\"0 0 24 24\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M14 5c-.552 0-1-.448-1-1s.448-1 1-1h6c.552 0 1 .448 1 1v6c0 .552-.448 1-1 1s-1-.448-1-1v-3.586l-7.293 7.293c-.391.39-1.024.39-1.414 0-.391-.391-.391-1.024 0-1.414l7.293-7.293h-3.586zm-9 2c-.552 0-1 .448-1 1v11c0 .552.448 1 1 1h11c.552 0 1-.448 1-1v-4.563c0-.552.448-1 1-1s1 .448 1 1v4.563c0 1.657-1.343 3-3 3h-11c-1.657 0-3-1.343-3-3v-11c0-1.657 1.343-3 3-3h4.563c.552 0 1 .448 1 1s-.448 1-1 1h-4.563z\" fill=\"currentColor\"></path></svg></a></li>\n</ul>\n<h3 id=\"下一步\">下一步 <a aria-hidden=\"true\" class=\"anchor\" href=\"#%e4%b8%8b%e4%b8%80%e6%ad%a5\"><i class=\"material-icons align-middle\">link</i></a></h3><!-- - 观看[第一部分：JWTs](../../learn/auth-deep-dive/auth-deep-dive-jwts) -->\n<ul>\n<li><a data-bs-delay='{\"hide\":300,\"show\":550}' data-bs-html=\"true\" data-bs-title=\"&lt;a href='/docs/app/development_guide/auth/auth-deep-dive/auth-row-level-security/'&gt;&lt;p&gt;深层探索&lt;/p&gt;&lt;strong&gt;第二部分:行级安全&lt;/strong&gt;&lt;br&gt;Supabase Auth Deep Dive第二部分 - 行级安全&lt;/a&gt;\" data-bs-toggle=\"tooltip\" href=\"/docs/app/development_guide/auth/auth-deep-dive/auth-row-level-security/\">第二部分:行级安全</a></li>\n<li><a data-bs-delay='{\"hide\":300,\"show\":550}' data-bs-html=\"true\" data-bs-title=\"&lt;a href='/docs/app/development_guide/auth/auth-deep-dive/auth-policies/'&gt;&lt;p&gt;深层探索&lt;/p&gt;&lt;strong&gt;第三部分:策略&lt;/strong&gt;&lt;br&gt;Supabase Auth Deep Dive第三部分：基于用户的访问策略&lt;/a&gt;\" data-bs-toggle=\"tooltip\" href=\"/docs/app/development_guide/auth/auth-deep-dive/auth-policies/\">第三部分:政策</a></li>\n<li><a data-bs-delay='{\"hide\":300,\"show\":550}' data-bs-html=\"true\" data-bs-title=\"&lt;a href='/docs/app/development_guide/auth/auth-deep-dive/auth-gotrue/'&gt;&lt;p&gt;深层探索&lt;/p&gt;&lt;strong&gt;第四部分: GoTrue&lt;/strong&gt;&lt;br&gt;Supabase深潜第四部分：Gotrue概述&lt;/a&gt;\" data-bs-toggle=\"tooltip\" href=\"/docs/app/development_guide/auth/auth-deep-dive/auth-gotrue/\">第四部分: GoTrue</a></li>\n<li>注册加入<a href=\"https://cloud.memfiredb.com/\" rel=\"external\" target=\"_blank\">MemFire Cloud<svg height=\"16\" viewbox=\"0 0 24 24\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M14 5c-.552 0-1-.448-1-1s.448-1 1-1h6c.552 0 1 .448 1 1v6c0 .552-.448 1-1 1s-1-.448-1-1v-3.586l-7.293 7.293c-.391.39-1.024.39-1.414 0-.391-.391-.391-1.024 0-1.414l7.293-7.293h-3.586zm-9 2c-.552 0-1 .448-1 1v11c0 .552.448 1 1 1h11c.552 0 1-.448 1-1v-4.563c0-.552.448-1 1-1s1 .448 1 1v4.563c0 1.657-1.343 3-3 3h-11c-1.657 0-3-1.343-3-3v-11c0-1.657 1.343-3 3-3h4.563c.552 0 1 .448 1 1s-.448 1-1 1h-4.563z\" fill=\"currentColor\"></path></svg></a></li>\n</ul>\n</div>\n</div>\n<div><hr class=\"doc-hr\"/>\n<div class=\"d-print-none\" id=\"doc-nav\">\n<div class=\"row flex-xl-nowrap\">\n<div class=\"col-sm-6 pt-2 doc-next\">\n<a href=\"/docs/app/development_guide/auth/auth-helpers/remix/\">\n<div class=\"card h-100 my-1\">\n<div class=\"card-body py-2\">\n<p class=\"card-title fs-5 fw-semibold lh-base mb-0\"><i class=\"material-icons align-middle\">navigate_before</i> Supabase Remix认证</p>\n</div>\n</div>\n</a>\n</div>\n<div class=\"col-sm-6 pt-2 doc-prev\">\n<a class=\"ms-auto\" href=\"/docs/app/development_guide/auth/auth-deep-dive/auth-row-level-security/\">\n<div class=\"card h-100 my-1 text-end\">\n<div class=\"card-body py-2\">\n<p class=\"card-title fs-5 fw-semibold lh-base mb-0\">第二部分:行级安全 <i class=\"material-icons align-middle\">navigate_next</i></p>\n</div>\n</div>\n</a>\n</div>\n</div>\n</div></div>\n</div>\n</div>\n</div>\n</div>\n\n</main>",
  "markdown": "[MemFireDB备份 6](/)\n\nmenu\n\n[官网](https://memfiredb.com/)\n[论坛](https://community.memfiredb.com/)\n[登录](https://cloud.memfiredb.com/auth/login)\n\nEnable dark mode\n\nEnable light mode\n\n本页\n\n关于\n\n# 第一部分:JWTS\n\n### 关于 [*link*](#%e5%85%b3%e4%ba%8e)\n\n对JWTs的介绍以及它们在Supabase Auth中的使用方法\n\n### 观察 [*link*](#%e8%a7%82%e5%af%9f)\n\n### 什么是JSON网络令牌（JWTs）？ [*link*](#%e4%bb%80%e4%b9%88%e6%98%afjson%e7%bd%91%e7%bb%9c%e4%bb%a4%e7%89%8cjwts)\n\nJWT是JSON对象，经过编码和签名，以字符串的形式发送。它们被分发给服务或网站的用户，用户随后可以向网站或服务展示JWT，作为他们有权访问某些内容的证明。\n\n当我们说 `编码`和 `签名`时，到底是什么意思？\n\nJSON对象开始时看起来像这样。\n\n```\n{\n  \"sub\": \"0001\",\n  \"name\": \"Sam Vimes\",\n  \"iat\": 1516239022,\n  \"exp\": 1518239022\n}\n```\n\n`sub`是 `主题`，通常是用户的UUID。`name`是不言自明的，`iat`是创建令牌的Unix时间戳。许多JWT也会有一个`exp`，这是该令牌被设定为过期而不能再使用的日期。这些是你可能在JWT中发现的一些标准字段，但你几乎可以在其中存储任何你想要的东西，例如。\n\n```\n{\n  \"sub\": \"0002\",\n  \"name\": \"Věra Hrabánková\",\n  \"iat\": 1516239022,\n  \"exp\": 1518239022,\n  \"theme\": {\n      \"primary\" : \"#D80C14\",\n      \"secondary\" : \"#FFFFFF\"\n  }\n}\n```\n\n只需注意，你在令牌中存储的数据越多，编码后的字符串就越长。\n\n当我们想把JWT发送给用户时，我们首先用一种算法对数据进行编码，如`HS256`。有许多库（和几种不同的算法）可以用来做这种编码/解码，例如[jsonwebtoken](https://www.npmjs.com/package/jsonwebtoken)。我做了一个副本[这里](https://replit.com/@awalias/jsonwebtokens#index.js)，所以你可以自己试试。签名的方法很简单。\n\n```\n// from https://replit.com/@awalias/jsonwebtokens#index.js\nlet token = jwt.sign({ name: 'Sam Vimes' }, 'some-secret')\n```\n\n而产生的字符串将看起来像这样。\n\n```\neyJhbGciOiJIUzI1NiJ9\n.eyJzdWIiOiIwMDAxIiwibmFtZSI6IlNhbSBWaW1lcyIsImlhdCI6MTUxNjIzOTAyMiwiZXhwIjoxNTE4MjM5MDIyfQ\n.zMcHjKlkGhuVsiPIkyAkB2rjXzyzJsMMgpvEGvGtjvA\n```\n\n你会注意到，这个字符串实际上是由三个部分组成的，我们将逐一解决这个问题。\n\n第一段`eyJhbGciOiJIUzI1NiJ9`被称为 `头`，在解码时只是告诉我们用哪种算法来做编码。\n\n```\n{\n  \"alg\": \"HS256\"\n}\n```\n\n第二段`eyJzdWIiOiIwMDAxIiwibmFtZSI6IlNhbSBWaW1lcyIsImlhdCI6MTUxNjIzOTAyMiwiZXhwIjoxNTE4MjM5MDIyfQ`包含我们的原始有效载荷。\n\n```\n{\n  \"sub\": \"0001\",\n  \"name\": \"Sam Vimes\",\n  \"iat\": 1516239022,\n  \"exp\": 1518239022\n}\n```\n\n最后一段`zMcHjKlkGhuVsiPIkyAkB2rjXzyzJsMMgpvEGvGtjvA`是签名本身，是网站或服务提供者用来验证某个用户发送的令牌是否合法的部分。它首先是通过对以下输入运行加密函数HS256产生的。\n\n```\nHMACSHA256(\n  base64UrlEncode(header) + \".\" +\n  base64UrlEncode(payload)\n  <jwt_secret>\n)\n```\n\n你可以在<https://jwt.io>上测试一下铸造你自己的代币。\n\n值得注意的是，任何拥有`jwt_secret`的人都可以创建新的令牌，也可以验证现有的令牌。更高级的JWT算法使用两个秘密：一个用于创建令牌，另一个用于验证签名令牌的有效性。\n\n你可能想知道为什么JWT突然间如此流行。答案是，随着微服务架构的大规模采用，我们遇到了这样一种情况：几个不同的微服务（API、网站、服务器等）想要轻松地验证一个用户是他们所说的人，或者换句话说，是一个 “登录 “用户。传统的会话令牌在这里没有用处，因为它们需要每个微服务维护一个当前有效的会话令牌的记录，或者在每次用户想要访问一个资源时查询一个中央数据库，以便检查会话令牌的有效性–效率确实很低。在这个意义上，基于JWT的认证是分散的，因为任何拥有 “jwt\\_secret “的人都可以验证一个令牌，而不需要访问一个中央数据库。\n\n注意：JWT的一个缺点是，它不像会话令牌那样可以轻易作废。如果JWT被泄露给恶意行为者，他们将能够在任何地方赎回它，直到到期日 - 当然，除非系统所有者更新`jwt_secret`（这当然会使\\_所有人的现有令牌失效）。\n\n### Supabase中的JWTs [*link*](#supabase%e4%b8%ad%e7%9a%84jwts)\n\n在Supabase中，我们为三个不同的目的发布JWTs：\n\n1. `匿名密钥`:这个密钥用于绕过Supabase API网关，可以在你的客户端代码中使用。\n2. `服务角色密钥`:此密钥具有超级管理员权限，可以绕过你的行级安全。不要把它放在你的客户端代码中。保持它的私密性。\n3. `用户特定的JWTS`:这些是我们发给登录你的项目/服务/网站的用户的令牌。它相当于现代的会话令牌，可以被用户用来访问他们特定的内容或权限。\n\n这里的第一个令牌，即 `匿名钥匙`令牌，是供开发人员在想与Supabase数据库进行交互时与他们的API请求一起发送。\n\n假设你想读取一个表`colors`中所有行的名字。我们会提出这样一个请求：\n\n```\ncurl 'https://xscduanzzfseqszwzhcy.supabase.co/rest/v1/colors?select=name' \\\n-H \"apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYxNDIwNTE3NCwiZXhwIjoxOTI5NzgxMTc0fQ.-NBR1WnZyQGpRLdXJfgfpszoZ0EeE6KHatJsDPLIX8c\"\n```\n\n如果我们把这个令牌放到https://jwt.io，我们看到它被解码为：\n\n```\n{\n  \"role\": \"anon\",\n  \"iss\": \"supabase\",\n  \"iat\": 1614205174,\n  \"exp\": 1929781174\n}\n```\n\n这个JWT是由开发人员的Supabase令牌所特有的`jwt_secret`签署的（你可以在设置>API页面下的仪表板上找到这个秘密和这个编码的 “anon key”），并且需要通过Supabase API网关并访问开发人员的项目。\n\n这个特定密钥的想法是，它可以安全地放入你的客户端，也就是说，如果你的终端用户看到这个密钥是可以的 - 但\\_只有在你首先启用行级安全的情况下，这是本系列的[第二部分](/docs/app/development_guide/auth/auth-deep-dive/auth-row-level-security/) 的主题。\n\n第二个密钥，`服务角色密钥`，应该只在你自己的服务器或环境中使用，而不应该与终端用户共享。你可以使用这个令牌来做一些事情，比如批量插入数据。\n\n`用户访问令牌`是当你呼叫时发出的JWT，例如:\n\n```\nsupabase.auth.signIn({\n  email: 'lao.gimmie@gov.sg',\n  password: 'They_Live_1988!',\n})\n```\n\n这个令牌应该在`apikey`头之外作为`授权承载者`头传递。\n\n```\ncurl 'https://xscduanzzfseqszwzhcy.supabase.co/rest/v1/colors?select=name' \\\n-H \"apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYxNDIwNTE3NCwiZXhwIjoxOTI5NzgxMTc0fQ.-NBR1WnZyQGpRLdXJfgfpszoZ0EeE6KHatJsDPLIX8c\" \\\n-H \"Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJhdXRoZW50aWNhdGVkIiwiZXhwIjoxNjE1ODI0Mzg4LCJzdWIiOiIwMzM0NzQ0YS1mMmEyLTRhYmEtOGM4YS02ZTc0OGY2MmExNzIiLCJlbWFpbCI6InNvbWVvbmVAZW1haWwuY29tIiwiYXBwX21ldGFkYXRhIjp7InByb3ZpZGVyIjoiZW1haWwifSwidXNlcl9tZXRhZGF0YSI6bnVsbCwicm9sZSI6ImF1dGhlbnRpY2F0ZWQifQ.I-_oSsJamtinGxniPETBf-ezAUwDW2sY9bJIThvdX9s\"\n```\n\n你会注意到，这个令牌相当长，因为它包含了用户的具体信息，如:\n\n```\n{\n  \"aud\": \"authenticated\",\n  \"exp\": 1615824388,\n  \"sub\": \"0334744a-f2a2-4aba-8c8a-6e748f62a172\",\n  \"email\": \"d.l.solove@gmail.com\",\n  \"app_metadata\": {\n    \"provider\": \"email\"\n  },\n  \"user_metadata\": null,\n  \"role\": \"authenticated\"\n}\n```\n\n现在你已经了解了什么是JWTs以及它们在Supabase中的用途，你可以探索如何将它们与行级安全相结合，开始限制对Postgres数据库中某些表、行和列的访问。[第二部分：行级安全](/docs/app/development_guide/auth/auth-deep-dive/auth-row-level-security/)\n\n### 资源 [*link*](#%e8%b5%84%e6%ba%90)\n\n* JWT debugger: <https://jwt.io/>\n\n### 下一步 [*link*](#%e4%b8%8b%e4%b8%80%e6%ad%a5)\n\n* [第二部分:行级安全](/docs/app/development_guide/auth/auth-deep-dive/auth-row-level-security/)\n* [第三部分:政策](/docs/app/development_guide/auth/auth-deep-dive/auth-policies/)\n* [第四部分: GoTrue](/docs/app/development_guide/auth/auth-deep-dive/auth-gotrue/)\n* 注册加入[MemFire Cloud](https://cloud.memfiredb.com/)\n\n---\n\n[*navigate\\_before* Supabase Remix认证](/docs/app/development_guide/auth/auth-helpers/remix/)\n\n[第二部分:行级安全 *navigate\\_next*](/docs/app/development_guide/auth/auth-deep-dive/auth-row-level-security/)"
}