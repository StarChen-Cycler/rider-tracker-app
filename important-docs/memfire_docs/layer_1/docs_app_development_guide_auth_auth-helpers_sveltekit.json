{
  "url": "https://docs.memfiredb.com/docs/app/development_guide/auth/auth-helpers/sveltekit/",
  "title": "使用SveltKit进行Supabase认证 | MemFire Cloud在线文档",
  "depth": 1,
  "timestamp": "2025-08-12 18:00:49",
  "html": "<main class=\"page-content bg-transparent\">\n<div class=\"top-header d-print-none\" id=\"top-header\">\n<div class=\"header-bar d-flex justify-content-between\">\n<div class=\"d-flex align-items-center\">\n<a alt=\"HomePage\" aria-label=\"HomePage\" class=\"logo-icon me-3\" href=\"/\">\n<div class=\"small\">\n<!--?xml version=\"1.0\" encoding=\"UTF-8\"?-->\n<svg height=\"112px\" version=\"1.1\" viewbox=\"0 0 99 112\" width=\"99px\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n<title>MemFireDB备份 6</title>\n<defs>\n<lineargradient id=\"linearGradient-1\" x1=\"49.9999885%\" x2=\"49.9999885%\" y1=\"98.082503%\" y2=\"0.766550128%\">\n<stop offset=\"0%\" stop-color=\"#ED1C23\"></stop>\n<stop offset=\"100%\" stop-color=\"#FBAF3B\"></stop>\n</lineargradient>\n</defs>\n<g fill=\"none\" fill-rule=\"evenodd\" id=\"定稿\" stroke=\"none\" stroke-width=\"1\">\n<g id=\"MemFireDB备份-6\">\n<polygon fill=\"#F9AE7C\" id=\"Fill-1\" points=\"25.9728553 40.7912363 47.4268317 0.00591833831 1.15453123 26.7215251\"></polygon>\n<polygon fill=\"#F9AE7C\" id=\"Fill-3\" points=\"97.4213117 26.7267606 51.1285247 0.000910513587 72.4242993 40.8351686\"></polygon>\n<polygon fill=\"#F9904A\" id=\"Fill-5\" points=\"24.8347133 42.7618153 0.000455256793 28.682999 0.000455256793 82.1608764\"></polygon>\n<polygon fill=\"url(#linearGradient-1)\" id=\"Fill-7\" points=\"27.6634514 42.4662399 49.279044 109.05096 70.7296059 42.507213 49.2779058 1.3747617\"></polygon>\n<polygon fill=\"#F9904A\" id=\"Fill-9\" points=\"98.5660549 28.6951771 73.5622137 42.8047233 98.5660549 82.1719163\"></polygon>\n<polygon fill=\"#FB6D33\" id=\"Fill-13\" points=\"72.2987623 45.061545 50.7514582 111.900071 97.579172 84.8646465\"></polygon>\n<polygon fill=\"#FB6D33\" id=\"Fill-15\" points=\"26.1006687 45.0226206 0.987565799 84.8644188 47.8095888 111.898705\"></polygon>\n<path d=\"M60.0737516,38.507213 C59.3168872,35.669825 57.0462939,33.3514298 57.0462939,33.3514298 C57.0462939,33.3514298 57.0804382,35.8849338 56.2894295,37.513615 C55.4847631,39.1696116 53.8765685,40.3054773 53.8765685,40.3054773 C53.8765685,40.3054773 56.1016361,33.8840802 54.2715038,30.1247973 C52.0259496,25.5073552 49.1771803,23.3357803 49.1771803,23.3357803 C49.1771803,23.3357803 50.1070423,28.1319107 48.6240432,31.5065016 C47.1672215,34.8264618 42.8058614,36.7260208 40.7241997,38.7132167 C39.1865699,40.1791435 38.0814341,43.0711623 37.6068289,44.4847347 C37.5715465,44.5883056 37.560165,44.6918765 37.5533362,44.7943093 C37.584066,43.9816759 37.8890881,39.8024186 40.9654858,37.4293925 C43.8404325,35.2111538 41.2431925,30.3478731 41.2431925,30.3478731 C41.2431925,30.3478731 41.7212121,32.5638355 40.9939394,34.1401622 C40.2655285,35.7153507 38.7187936,36.5962726 38.0154218,38.259098 C37.3883056,39.7409589 37.5203301,44.1432921 37.5453692,44.8409731 C37.5453692,44.8591834 37.5476455,44.8762555 37.5476455,44.8921895 C37.5476455,44.9263338 37.5487836,44.9456822 37.5487836,44.9456822 L37.5487836,44.9115379 C37.5590269,45.2655001 37.7138142,45.6080808 37.9972116,45.8448143 L48.3713757,55.6442168 C48.8380139,56.0323232 49.5163466,56.0334614 49.9841229,55.6476312 L60.5938825,45.7105136 C60.9034571,45.4544316 61.0719021,45.0686015 61.0457249,44.6656992 C60.9546735,43.2282259 60.5699815,40.3692133 60.0737516,38.507213\" fill=\"#FFFFFF\" id=\"Fill-17\"></path>\n</g>\n</g>\n</svg>\n</div>\n<div class=\"big\">\n<svg height=\"20\" width=\"232\" xmlns=\"http://www.w3.org/2000/svg\"><defs><lineargradient id=\"a\" x1=\"50%\" x2=\"50%\" y1=\"98.083%\" y2=\".767%\"><stop offset=\"0%\" stop-color=\"#ED1C23\"></stop><stop offset=\"100%\" stop-color=\"#FBAF3B\"></stop></lineargradient></defs><g fill=\"none\" fill-rule=\"evenodd\"><path d=\"M78.622 12.384l1.596 21.94H77.49l-.847-14.154-8.98 15.523-4.899-15.53-4.416 14.162H55.6l7.085-21.871 5.712 17.174 10.224-17.244zm99.46.382l.324.01.454.036c.085.008.175.018.269.03l.61.096c1.09.203 2.518.644 3.883 1.596l.515.383-.46 3.694-.413-.62-.154-.195-.255-.285c-.765-.802-2.485-2.188-5.23-2.188-4.55 0-8.723 3.809-9.3 8.491-.287 2.311.334 4.469 1.755 6.077 1.342 1.517 3.257 2.354 5.39 2.354 2.606 0 4.58-1.225 5.606-2.04l.359-.3.424-.408.507-.552-.466 3.766-.093.06a12.622 12.622 0 01-4.577 1.842l-.629.1-.53.058-.418.027-.444.003c-2.918-.002-5.532-1.142-7.36-3.21-1.851-2.096-2.67-4.88-2.305-7.837.73-5.88 5.964-10.696 11.806-10.974l.732-.014zm18.174 9.018c1.724 0 3.344.713 4.443 1.956 1.101 1.248 1.59 2.88 1.377 4.596-.432 3.504-3.808 6.466-7.375 6.466-1.728 0-3.348-.715-4.45-1.96-1.096-1.242-1.583-2.864-1.377-4.563.44-3.52 3.818-6.495 7.382-6.495zm19.446.535l-1.486 12.02h-2.558l.16-1.292c-.936.93-2.462 1.755-4.173 1.755-1.318 0-2.48-.492-3.267-1.385-.804-.91-1.168-2.184-1.008-3.497l.9-7.274 2.597-.327-.914 7.402c-.101.785.084 1.466.525 1.968.49.552 1.27.845 2.25.845 1.526 0 3.3-1.155 3.51-2.873l.87-7.015 2.594-.327zm-63.587-.547c1.77 0 3.21.58 4.164 1.678 1.047 1.207 1.48 3.01 1.263 5.233l-.097.771h-9.914c.16 1.896 1.567 2.979 3.895 2.979 1.806 0 2.878-.434 3.868-.961l1.119-.623-.312 2.522-.106.06c-1.224.687-2.604 1.356-4.8 1.356-2.092 0-3.873-.708-5.006-1.992-.991-1.12-1.404-2.599-1.198-4.272.548-4.433 4.001-6.751 7.124-6.751zm-62.717 0c1.771 0 3.211.58 4.164 1.678 1.048 1.207 1.48 3.01 1.263 5.233l-.097.771h-9.914c.16 1.896 1.567 2.979 3.895 2.979 1.622 0 2.652-.35 3.563-.803l.594-.315.83-.466-.312 2.522-.105.06c-1.224.687-2.604 1.356-4.8 1.356-2.093 0-3.874-.708-5.007-1.992-.99-1.12-1.404-2.599-1.197-4.272.547-4.433 4-6.751 7.123-6.751zM231.476 12l-2.767 22.34h-2.556l.197-1.59c-1.104 1.191-2.882 2.021-4.471 2.021-1.781 0-3.24-.583-4.217-1.69-1.02-1.151-1.452-2.817-1.222-4.686.485-3.908 3.43-6.636 7.167-6.636 1.565 0 3.065.832 3.852 2.064l1.356-10.968 2.661-.855zm-42.07.002L186.64 34.34h-2.556l2.664-21.483 2.66-.854zm-56.632 1.268l-1.166 2.527h-9.586l-.85 6.867h6.627v.48h-.12l-.883 1.778v.24h-5.933l-1.138 9.163h-2.729l2.612-21.055h13.166zm2.715 9.038l-1.497 12.017h-2.559l1.455-11.722 2.601-.295zm-24.427-.537c1 0 1.93.427 2.616 1.204.84.95 1.224 2.29 1.053 3.677l-.955 7.673h-2.527l.922-7.445c.13-1.017-.027-1.81-.45-2.287-.326-.367-.815-.554-1.458-.554-1.954 0-3.178 1.346-3.332 2.613l-.955 7.673h-2.556l.922-7.445c.127-1.03-.024-1.826-.442-2.297-.319-.362-.801-.544-1.437-.544-1.522 0-3.3 1.166-3.516 2.901l-.912 7.385h-2.559l1.455-11.722 2.594-.295-.146 1.164c1.027-1.077 2.419-1.701 3.854-1.701 1.375 0 2.58.79 3.226 2.083.914-1.13 2.05-2.083 4.603-2.083zm29.487.532l-.206 1.73c1.082-.978 2.932-1.7 4.514-1.7h.269l-.271 2.282h-.214c-1.814 0-4.469.837-4.7 2.7l-.866 7.01h-2.558l1.45-11.693 2.582-.329zm55.47 1.865c-2.31 0-4.27 1.792-4.563 4.168-.144 1.145.15 2.196.824 2.957.64.725 1.586 1.126 2.656 1.126 2.292 0 4.241-1.78 4.532-4.14.146-1.169-.144-2.237-.821-3.003-.634-.715-1.567-1.108-2.628-1.108zm27.497-.029c-2.278 0-4.15 1.752-4.45 4.17-.149 1.187.137 2.255.8 3.006.611.692 1.526 1.076 2.57 1.076 2.294 0 4.173-1.743 4.468-4.143.152-1.21-.13-2.285-.79-3.033-.623-.704-1.52-1.076-2.598-1.076zm-134.356.045c-1.89 0-3.372 1.094-4.015 2.947h7.164a2.853 2.853 0 00-.71-1.956c-.574-.648-1.416-.991-2.439-.991zm62.715 0c-1.892 0-3.37 1.094-4.013 2.947h7.166a2.867 2.867 0 00-.713-1.956c-.573-.648-1.416-.991-2.44-.991zm-17.267-7.614c.919 0 1.706.748 1.754 1.668a1.587 1.587 0 01-1.603 1.692c-.917 0-1.704-.75-1.754-1.668a1.593 1.593 0 011.603-1.692z\" fill=\"#116\"></path><path d=\"M11.131 17.482L20.326.002.495 11.453zm30.621-6.028L21.912 0l9.127 17.5z\" fill=\"#F9AE7C\"></path><path d=\"M10.643 18.326L0 12.293v22.919z\" fill=\"#F9904A\"></path><path d=\"M11.856 18.2l9.264 28.536 9.193-28.519L21.119.59z\" fill=\"url(#a)\"></path><path d=\"M42.243 12.298l-10.716 6.047 10.716 16.872z\" fill=\"#F9904A\"></path><path d=\"M30.985 19.312l-9.234 28.645L41.82 36.371zm-19.799-.017L.423 36.37 20.49 47.957z\" fill=\"#FB6D33\"></path><path d=\"M25.746 16.503c-.324-1.216-1.298-2.21-1.298-2.21s.015 1.086-.324 1.784c-.345.71-1.034 1.197-1.034 1.197s.954-2.752.17-4.363c-.963-1.98-2.184-2.91-2.184-2.91s.398 2.056-.237 3.502c-.624 1.423-2.494 2.237-3.386 3.088-.659.629-1.132 1.868-1.336 2.474a.509.509 0 00-.023.133c.013-.349.144-2.14 1.463-3.157 1.232-.95.119-3.035.119-3.035s.205.95-.107 1.625c-.312.676-.975 1.053-1.277 1.766-.268.635-.212 2.522-.201 2.82v.023l.001.022v-.014a.54.54 0 00.193.4l4.446 4.2c.2.166.49.166.69.001l4.548-4.259a.535.535 0 00.193-.448c-.039-.616-.203-1.84-.416-2.639\" fill=\"#FFF\"></path></g></svg>\n</div>\n</a>\n<button class=\"btn btn-icon btn-soft\" id=\"close-sidebar\">\n<span class=\"material-icons size-20 menu-icon align-middle\">menu</span>\n</button>\n</div>\n<div class=\"d-flex align-items-center\">\n<ul class=\"list-unstyled mb-0\">\n</ul>\n<a class=\"btn btn-icon btn-default ms-4\" href=\"https://memfiredb.com/\" target=\"_blank\" type=\"button\">官网</a>\n<a class=\"btn btn-icon btn-default ms-4\" href=\"https://community.memfiredb.com/\" target=\"_blank\" type=\"button\">论坛</a>\n<a class=\"btn btn-icon btn-default ms-4\" href=\"https://cloud.memfiredb.com/auth/login\" target=\"_blank\" type=\"button\">登录</a>\n<button aria-label=\"Toggle user interface mode\" class=\"btn btn-icon btn-default ms-2\" id=\"mode\" type=\"button\">\n<span class=\"toggle-dark\">\n<svg fill=\"currentColor\" height=\"30\" viewbox=\"0 0 48 48\" width=\"30\" xmlns=\"http://www.w3.org/2000/svg\">\n<title>Enable dark mode</title>\n<path d=\"M24 42q-7.5 0-12.75-5.25T6 24q0-7.5 5.25-12.75T24 6q.4 0 .85.025.45.025 1.15.075-1.8 1.6-2.8 3.95-1 2.35-1 4.95 0 4.5 3.15 7.65Q28.5 25.8 33 25.8q2.6 0 4.95-.925T41.9 22.3q.05.6.075.975Q42 23.65 42 24q0 7.5-5.25 12.75T24 42Zm0-3q5.45 0 9.5-3.375t5.05-7.925q-1.25.55-2.675.825Q34.45 28.8 33 28.8q-5.75 0-9.775-4.025T19.2 15q0-1.2.25-2.575.25-1.375.9-3.125-4.9 1.35-8.125 5.475Q9 18.9 9 24q0 6.25 4.375 10.625T24 39Zm-.2-14.85Z\"></path>\n</svg>\n</span>\n<span class=\"toggle-light\">\n<svg fill=\"currentColor\" height=\"30\" viewbox=\"0 0 48 48\" width=\"30\" xmlns=\"http://www.w3.org/2000/svg\">\n<title>Enable light mode</title>\n<path d=\"M24 31q2.9 0 4.95-2.05Q31 26.9 31 24q0-2.9-2.05-4.95Q26.9 17 24 17q-2.9 0-4.95 2.05Q17 21.1 17 24q0 2.9 2.05 4.95Q21.1 31 24 31Zm0 3q-4.15 0-7.075-2.925T14 24q0-4.15 2.925-7.075T24 14q4.15 0 7.075 2.925T34 24q0 4.15-2.925 7.075T24 34ZM3.5 25.5q-.65 0-1.075-.425Q2 24.65 2 24q0-.65.425-1.075Q2.85 22.5 3.5 22.5h5q.65 0 1.075.425Q10 23.35 10 24q0 .65-.425 1.075-.425.425-1.075.425Zm36 0q-.65 0-1.075-.425Q38 24.65 38 24q0-.65.425-1.075.425-.425 1.075-.425h5q.65 0 1.075.425Q46 23.35 46 24q0 .65-.425 1.075-.425.425-1.075.425ZM24 10q-.65 0-1.075-.425Q22.5 9.15 22.5 8.5v-5q0-.65.425-1.075Q23.35 2 24 2q.65 0 1.075.425.425.425.425 1.075v5q0 .65-.425 1.075Q24.65 10 24 10Zm0 36q-.65 0-1.075-.425-.425-.425-.425-1.075v-5q0-.65.425-1.075Q23.35 38 24 38q.65 0 1.075.425.425.425.425 1.075v5q0 .65-.425 1.075Q24.65 46 24 46ZM12 14.1l-2.85-2.8q-.45-.45-.425-1.075.025-.625.425-1.075.45-.45 1.075-.45t1.075.45L14.1 12q.4.45.4 1.05 0 .6-.4 1-.4.45-1.025.45-.625 0-1.075-.4Zm24.7 24.75L33.9 36q-.4-.45-.4-1.075t.45-1.025q.4-.45 1-.45t1.05.45l2.85 2.8q.45.45.425 1.075-.025.625-.425 1.075-.45.45-1.075.45t-1.075-.45ZM33.9 14.1q-.45-.45-.45-1.05 0-.6.45-1.05l2.8-2.85q.45-.45 1.075-.425.625.025 1.075.425.45.45.45 1.075t-.45 1.075L36 14.1q-.4.4-1.025.4-.625 0-1.075-.4ZM9.15 38.85q-.45-.45-.45-1.075t.45-1.075L12 33.9q.45-.45 1.05-.45.6 0 1.05.45.45.45.45 1.05 0 .6-.45 1.05l-2.8 2.85q-.45.45-1.075.425-.625-.025-1.075-.425ZM24 24Z\"></path>\n</svg>\n</span>\n</button>\n</div>\n</div>\n</div>\n<div class=\"container-fluid\">\n<div class=\"layout-spacing\">\n<div class=\"d-md-flex justify-content-between align-items-center\"></div>\n<div class=\"row flex-xl-nowrap\">\n<div class=\"docs-toc col-xl-3 d-xl-block\"><toc>\n<div class=\"fw-bold text-uppercase mb-2\">本页</div>\n\n</toc></div>\n<div class=\"docs-toc-mobile d-print-none d-xl-none\">\n<button aria-expanded=\"false\" class=\"btn-secondary dropdown-toggle\" data-bs-offset=\"0,0\" data-bs-toggle=\"dropdown\" id=\"toc-dropdown-btn\" type=\"button\">安装</button>\n</div>\n<div class=\"docs-content col-12 col-xl-9 mt-0\">\n<div class=\"mb-0 d-flex\">\n<h1 class=\"content-title mb-0\">\n                                                    使用SveltKit进行Supabase认证\n                                                    \n                                                </h1>\n</div>\n<div class=\"main-content\" data-bs-root-margin=\"0px 0px -65%\" data-bs-spy=\"scroll\" data-bs-target=\"#toc-mobile\" id=\"content\">\n<div data-prismjs-copy=\"\" data-prismjs-copy-error=\"\" data-prismjs-copy-success=\"\">\n<p>该子模块提供了在<a href=\"https://kit.svelte.dev/\" rel=\"external\" target=\"_blank\">SvelteKit<svg height=\"16\" viewbox=\"0 0 24 24\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M14 5c-.552 0-1-.448-1-1s.448-1 1-1h6c.552 0 1 .448 1 1v6c0 .552-.448 1-1 1s-1-.448-1-1v-3.586l-7.293 7.293c-.391.39-1.024.39-1.414 0-.391-.391-.391-1.024 0-1.414l7.293-7.293h-3.586zm-9 2c-.552 0-1 .448-1 1v11c0 .552.448 1 1 1h11c.552 0 1-.448 1-1v-4.563c0-.552.448-1 1-1s1 .448 1 1v4.563c0 1.657-1.343 3-3 3h-11c-1.657 0-3-1.343-3-3v-11c0-1.657 1.343-3 3-3h4.563c.552 0 1 .448 1 1s-.448 1-1 1h-4.563z\" fill=\"currentColor\"></path></svg></a>中实现用户身份验证的方便助手应用程序。</p>\n<h2 id=\"安装\">安装 <a aria-hidden=\"true\" class=\"anchor\" href=\"#%e5%ae%89%e8%a3%85\"><i class=\"material-icons align-middle\">link</i></a></h2><p>此库支持Node.js<code>^16.15.0</code>。</p>\n\n<div class=\"tab-content\" id=\"nav-tab-content\">\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade show active\" id=\"efdbac\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-sh\" id=\"acf76e8\" tabindex=\"0\"><code class=\"language-sh\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> @supabase/auth-helpers-sveltekit</code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade\" id=\"fdebac\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-sh\" id=\"fe15870\" tabindex=\"0\"><code class=\"language-sh\"><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> @supabase/auth-helpers-sveltekit</code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n</div>\n<h2 id=\"入门\">入门 <a aria-hidden=\"true\" class=\"anchor\" href=\"#%e5%85%a5%e9%97%a8\"><i class=\"material-icons align-middle\">link</i></a></h2><h3 id=\"配置\">配置 <a aria-hidden=\"true\" class=\"anchor\" href=\"#%e9%85%8d%e7%bd%ae\"><i class=\"material-icons align-middle\">link</i></a></h3><p>设置填充环境变量。对于本地开发，您可以将其设置为<code>.env</code>文件。参见<a href=\"https://github.com/supabase/auth-helpers/blob/main/examples/sveltekit/.env.example\" rel=\"external\" target=\"_blank\">示例<svg height=\"16\" viewbox=\"0 0 24 24\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M14 5c-.552 0-1-.448-1-1s.448-1 1-1h6c.552 0 1 .448 1 1v6c0 .552-.448 1-1 1s-1-.448-1-1v-3.586l-7.293 7.293c-.391.39-1.024.39-1.414 0-.391-.391-.391-1.024 0-1.414l7.293-7.293h-3.586zm-9 2c-.552 0-1 .448-1 1v11c0 .552.448 1 1 1h11c.552 0 1-.448 1-1v-4.563c0-.552.448-1 1-1s1 .448 1 1v4.563c0 1.657-1.343 3-3 3h-11c-1.657 0-3-1.343-3-3v-11c0-1.657 1.343-3 3-3h4.563c.552 0 1 .448 1 1s-.448 1-1 1h-4.563z\" fill=\"currentColor\"></path></svg></a>.</p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-bash\" id=\"837a41d\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"token comment\"># Find these in your Supabase project settings &gt; API</span>\n<span class=\"token assign-left variable\">PUBLIC_SUPABASE_URL</span><span class=\"token operator\">=</span>https://your-project.supabase.co\n<span class=\"token assign-left variable\">PUBLIC_SUPABASE_ANON_KEY</span><span class=\"token operator\">=</span>your-anon-key</code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<h3 id=\"设置suabase客户端\">设置Suabase客户端 <a aria-hidden=\"true\" class=\"anchor\" href=\"#%e8%ae%be%e7%bd%aesuabase%e5%ae%a2%e6%88%b7%e7%ab%af\"><i class=\"material-icons align-middle\">link</i></a></h3><p>首先创建一个<code>db.ts</code>文件，并实例化 <code>supabaseClient</code>。</p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"51ad8c3\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createClient <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> env <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$env/dynamic/public'</span>\n<span class=\"token comment\">// or use the static env</span>\n<span class=\"token comment\">// import { PUBLIC_SUPABASE_URL, PUBLIC_SUPABASE_ANON_KEY } from '$env/static/public';</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> supabaseClient <span class=\"token operator\">=</span> <span class=\"token function\">createClient</span><span class=\"token punctuation\">(</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PUBLIC_SUPABASE_URL</span><span class=\"token punctuation\">,</span> env<span class=\"token punctuation\">.</span><span class=\"token constant\">PUBLIC_SUPABASE_ANON_KEY</span><span class=\"token punctuation\">)</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<p>要确保在服务器和客户端上初始化了客户端，请在<code>src/hooks.server.js</code>中包含此文件。js<code>和</code>src/hooks.client.js`：</p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"d312cd5\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token string\">'$lib/db'</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<h3 id=\"同步页面存储\">同步页面存储 <a aria-hidden=\"true\" class=\"anchor\" href=\"#%e5%90%8c%e6%ad%a5%e9%a1%b5%e9%9d%a2%e5%ad%98%e5%82%a8\"><i class=\"material-icons align-middle\">link</i></a></h3><p>编辑<code>+layout.svelte</code>文件并设置客户端。</p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-html\" id=\"0a5e583\" tabindex=\"0\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> supabaseClient <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$lib/db'</span>\n  <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> invalidate <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$app/navigation'</span>\n  <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> onMount <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'svelte'</span>\n\n  <span class=\"token function\">onMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> subscription <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> supabaseClient<span class=\"token punctuation\">.</span>auth<span class=\"token punctuation\">.</span><span class=\"token function\">onAuthStateChange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">invalidate</span><span class=\"token punctuation\">(</span><span class=\"token string\">'supabase:auth'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      subscription<span class=\"token punctuation\">.</span><span class=\"token function\">unsubscribe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>slot</span> <span class=\"token punctuation\">/&gt;</span></span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<p>调用 <code>invalidate('supabase:auth')</code>时，使用<code>getSupabase()</code> 的每个<code>PageLoad</code>或 <code>LayoutLoad</code>都将更新。</p>\n<p>如果某些数据在登录/注销时未更新，则可以返回到 <code>invalidateAll()</code>。</p>\n<h3 id=\"向客户端发送会话\">向客户端发送会话 <a aria-hidden=\"true\" class=\"anchor\" href=\"#%e5%90%91%e5%ae%a2%e6%88%b7%e7%ab%af%e5%8f%91%e9%80%81%e4%bc%9a%e8%af%9d\"><i class=\"material-icons align-middle\">link</i></a></h3><p>要使会话对UI（页面、布局）可用，请在根布局服务器加载函数中传递会话：</p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"bcacc34\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token keyword\">type</span> <span class=\"token punctuation\">{</span> LayoutServerLoad <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./$types'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getServerSession <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> load<span class=\"token operator\">:</span> <span class=\"token function-variable function\">LayoutServerLoad</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    session<span class=\"token operator\">:</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getServerSession</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<p>此外，如果使用<code>invalidate('supabase:auth')</code>，则可以创建布局加载函数：</p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"9f07619\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token keyword\">type</span> <span class=\"token punctuation\">{</span> LayoutLoad <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./$types'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getSupabase <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> load<span class=\"token operator\">:</span> <span class=\"token function-variable function\">LayoutLoad</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> session <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getSupabase</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> session <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<p>这会减少服务器调用，因为客户端自己管理会话。</p>\n<h3 id=\"键入\">键入 <a aria-hidden=\"true\" class=\"anchor\" href=\"#%e9%94%ae%e5%85%a5\"><i class=\"material-icons align-middle\">link</i></a></h3><p>为了充分利用TypeScript及其智能感知，您应该将我们的类型导入到SveltKit项目附带的<code>app.d.ts</code>类型定义文件中。</p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"bf1b965\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token comment\">/// &lt;reference types=\"@sveltejs/kit\" /&gt;</span>\n\n<span class=\"token comment\">// See https://kit.svelte.dev/docs/types#app</span>\n<span class=\"token comment\">// for information about these interfaces</span>\n<span class=\"token comment\">// and what to do when importing types</span>\n<span class=\"token keyword\">declare</span> <span class=\"token keyword\">namespace</span> App <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Supabase</span> <span class=\"token punctuation\">{</span>\n    Database<span class=\"token operator\">:</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./DatabaseDefinitions'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Database\n    SchemaName<span class=\"token operator\">:</span> <span class=\"token string\">'public'</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// interface Locals {}</span>\n  <span class=\"token keyword\">interface</span> <span class=\"token class-name\">PageData</span> <span class=\"token punctuation\">{</span>\n    session<span class=\"token operator\">:</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@supabase/supabase-js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Session <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// interface Error {}</span>\n  <span class=\"token comment\">// interface Platform {}</span>\n<span class=\"token punctuation\">}</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<h3 id=\"基本设置\">基本设置 <a aria-hidden=\"true\" class=\"anchor\" href=\"#%e5%9f%ba%e6%9c%ac%e8%ae%be%e7%bd%ae\"><i class=\"material-icons align-middle\">link</i></a></h3><p>现在，您可以通过检查 <code>$page.data</code>中的<code>session</code>对象来确定用户是否在客户端进行了身份验证。</p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-html\" id=\"e50cbb0\" tabindex=\"0\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> page <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$app/stores'</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n\n{#if !$page.data.session}\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">&gt;</span></span>I am not logged in<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">&gt;</span></span>\n{:else}\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">&gt;</span></span>Welcome {$page.data.session.user.email}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">&gt;</span></span>I am logged in!<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">&gt;</span></span>\n{/if}</code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<h2 id=\"使用rls获取客户端数据\">使用RLS获取客户端数据 <a aria-hidden=\"true\" class=\"anchor\" href=\"#%e4%bd%bf%e7%94%a8rls%e8%8e%b7%e5%8f%96%e5%ae%a2%e6%88%b7%e7%ab%af%e6%95%b0%e6%8d%ae\"><i class=\"material-icons align-middle\">link</i></a></h2><p>为了使<a href=\"/docs/learn/auth-deep-dive/auth-row-level-security\">行级别安全</a>在客户端获取数据时正常工作，您需要确保从 <code>$lib/db</code>导入 <code>{ supabaseClient }</code>，并仅在 <code>$page.data</code>中定义了客户端会话后才运行查询：</p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-html\" id=\"13e5415\" tabindex=\"0\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> supabaseClient <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$lib/db'</span>\n  <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> page <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$app/stores'</span>\n\n  <span class=\"token keyword\">let</span> loadedData <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">loadData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> supabaseClient<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">'*'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">limit</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span>\n    loadedData <span class=\"token operator\">=</span> data\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token literal-property property\">$</span><span class=\"token operator\">:</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>$page<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">loadData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n\n{#if $page.data.session}\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">&gt;</span></span>client-side data fetching with RLS<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pre</span><span class=\"token punctuation\">&gt;</span></span>{JSON.stringify(loadedData, null, 2)}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pre</span><span class=\"token punctuation\">&gt;</span></span>\n{/if}</code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<h2 id=\"使用rls获取服务器端数据\">使用RLS获取服务器端数据 <a aria-hidden=\"true\" class=\"anchor\" href=\"#%e4%bd%bf%e7%94%a8rls%e8%8e%b7%e5%8f%96%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%ab%af%e6%95%b0%e6%8d%ae\"><i class=\"material-icons align-middle\">link</i></a></h2>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-html\" id=\"27e19a4\" tabindex=\"0\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token comment\">/** @type {import('./$types').PageData} */</span>\n  <span class=\"token keyword\">export</span> <span class=\"token keyword\">let</span> data\n  <span class=\"token literal-property property\">$</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> user<span class=\"token punctuation\">,</span> tableData <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> data<span class=\"token punctuation\">)</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span>Protected content for {user.email}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pre</span><span class=\"token punctuation\">&gt;</span></span>{JSON.stringify(tableData, null, 2)}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pre</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pre</span><span class=\"token punctuation\">&gt;</span></span>{JSON.stringify(user, null, 2)}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pre</span><span class=\"token punctuation\">&gt;</span></span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<p>要使<a href=\"/docs/learn/auth-deep-dive/auth-row-level-security\">row-level security</a>在服务器环境中工作，您需要使用 <code>getSupabase</code>帮助器来检查用户是否经过身份验证。助手需要 <code>event</code> 并返回 <code>session</code> 和 <code>supabaseClient</code>：</p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"5471167\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token keyword\">type</span> <span class=\"token punctuation\">{</span> PageLoad <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./$types'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getSupabase <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> redirect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@sveltejs/kit'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> load<span class=\"token operator\">:</span> <span class=\"token function-variable function\">PageLoad</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> session<span class=\"token punctuation\">,</span> supabaseClient <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getSupabase</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>session<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span><span class=\"token number\">303</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data<span class=\"token operator\">:</span> tableData <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> supabaseClient<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">'*'</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    user<span class=\"token operator\">:</span> session<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">,</span>\n    tableData<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<h2 id=\"保护api路由\">保护API路由 <a aria-hidden=\"true\" class=\"anchor\" href=\"#%e4%bf%9d%e6%8a%a4api%e8%b7%af%e7%94%b1\"><i class=\"material-icons align-middle\">link</i></a></h2><p>包装API路由以检查用户是否具有有效会话。如果他们未登录，则会话为 <code>null</code>。</p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"68eca24\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token keyword\">type</span> <span class=\"token punctuation\">{</span> RequestHandler <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./$types'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getSupabase <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> json<span class=\"token punctuation\">,</span> redirect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@sveltejs/kit'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">GET</span><span class=\"token operator\">:</span> <span class=\"token function-variable function\">RequestHandler</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> session<span class=\"token punctuation\">,</span> supabaseClient <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getSupabase</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>session<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span><span class=\"token number\">303</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> supabaseClient<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">'*'</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<p>如果您在没有有效会话cookie的情况下访问<code>/api/protected-route</code>，将得到303响应。</p>\n<h2 id=\"保护措施\">保护措施 <a aria-hidden=\"true\" class=\"anchor\" href=\"#%e4%bf%9d%e6%8a%a4%e6%8e%aa%e6%96%bd\"><i class=\"material-icons align-middle\">link</i></a></h2><p>包装操作以检查用户是否具有有效会话。如果他们未登录，则会话为 <code>null</code>。</p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"3fb11e8\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token keyword\">type</span> <span class=\"token punctuation\">{</span> Actions <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./$types'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getSupabase <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> error<span class=\"token punctuation\">,</span> invalid <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@sveltejs/kit'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> actions<span class=\"token operator\">:</span> Actions <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">createPost</span><span class=\"token operator\">:</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> request <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> event\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> session<span class=\"token punctuation\">,</span> supabaseClient <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getSupabase</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>session<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// the user is not signed in</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token number\">403</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> message<span class=\"token operator\">:</span> <span class=\"token string\">'Unauthorized'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// we are save, let the user create the post</span>\n    <span class=\"token keyword\">const</span> formData <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">formData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> content <span class=\"token operator\">=</span> formData<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'content'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> error<span class=\"token operator\">:</span> createPostError<span class=\"token punctuation\">,</span> data<span class=\"token operator\">:</span> newPost <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> supabaseClient\n      <span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">'posts'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> content <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>createPostError<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token function\">invalid</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        supabaseErrorMessage<span class=\"token operator\">:</span> createPostError<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      newPost<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<p>如果您尝试提交带有操作的表单 <code>?/createPost</code>如果没有有效的会话cookie，您将得到403错误响应。</p>\n<h2 id=\"保存和删除会话\">保存和删除会话 <a aria-hidden=\"true\" class=\"anchor\" href=\"#%e4%bf%9d%e5%ad%98%e5%92%8c%e5%88%a0%e9%99%a4%e4%bc%9a%e8%af%9d\"><i class=\"material-icons align-middle\">link</i></a></h2>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"6a51920\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token keyword\">type</span> <span class=\"token punctuation\">{</span> Actions <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./$types'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> invalid<span class=\"token punctuation\">,</span> redirect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@sveltejs/kit'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getSupabase <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> actions<span class=\"token operator\">:</span> Actions <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">signin</span><span class=\"token operator\">:</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> request<span class=\"token punctuation\">,</span> cookies<span class=\"token punctuation\">,</span> url <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> event\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> session<span class=\"token punctuation\">,</span> supabaseClient <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getSupabase</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> formData <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">formData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">const</span> email <span class=\"token operator\">=</span> formData<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'email'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span>\n    <span class=\"token keyword\">const</span> password <span class=\"token operator\">=</span> formData<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'password'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span>\n\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> error <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> supabaseClient<span class=\"token punctuation\">.</span>auth<span class=\"token punctuation\">.</span><span class=\"token function\">signInWithPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      email<span class=\"token punctuation\">,</span>\n      password<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>error <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">AuthApiError</span> <span class=\"token operator\">&amp;&amp;</span> error<span class=\"token punctuation\">.</span>status <span class=\"token operator\">===</span> <span class=\"token number\">400</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">invalid</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n          error<span class=\"token operator\">:</span> <span class=\"token string\">'Invalid credentials.'</span><span class=\"token punctuation\">,</span>\n          values<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            email<span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">return</span> <span class=\"token function\">invalid</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        error<span class=\"token operator\">:</span> <span class=\"token string\">'Server error. Try again later.'</span><span class=\"token punctuation\">,</span>\n        values<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          email<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">throw</span> <span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span><span class=\"token number\">303</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/dashboard'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function-variable function\">signout</span><span class=\"token operator\">:</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> supabaseClient <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getSupabase</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">await</span> supabaseClient<span class=\"token punctuation\">.</span>auth<span class=\"token punctuation\">.</span><span class=\"token function\">signOut</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span><span class=\"token number\">303</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<h2 id=\"保护多条路线\">保护多条路线 <a aria-hidden=\"true\" class=\"anchor\" href=\"#%e4%bf%9d%e6%8a%a4%e5%a4%9a%e6%9d%a1%e8%b7%af%e7%ba%bf\"><i class=\"material-icons align-middle\">link</i></a></h2><p>为了避免在每条路由中写入相同的身份验证逻辑，可以使用句柄钩子同时保护多条路由。</p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"b592020\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token keyword\">type</span> <span class=\"token punctuation\">{</span> RequestHandler <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./$types'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getSupabase <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> redirect<span class=\"token punctuation\">,</span> error <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@sveltejs/kit'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> handle<span class=\"token operator\">:</span> <span class=\"token function-variable function\">Handle</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> event<span class=\"token punctuation\">,</span> resolve <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// protect requests to all routes that start with /protected-routes</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">.</span>pathname<span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/protected-routes'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> session<span class=\"token punctuation\">,</span> supabaseClient <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getSupabase</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>session<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span><span class=\"token number\">303</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// protect POST requests to all routes that start with /protected-posts</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">.</span>pathname<span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/protected-posts'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> event<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>method <span class=\"token operator\">===</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> session<span class=\"token punctuation\">,</span> supabaseClient <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getSupabase</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>session<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token number\">303</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<h2 id=\"migration\">从0.7.x迁移到0.8 <a aria-hidden=\"true\" class=\"anchor\" href=\"#migration\"><i class=\"material-icons align-middle\">link</i></a></h2><h3 id=\"migration-set-up-supabase-client\">设置Supabase客户端 <a aria-hidden=\"true\" class=\"anchor\" href=\"#migration-set-up-supabase-client\"><i class=\"material-icons align-middle\">link</i></a></h3>\n\n<div class=\"tab-content\" id=\"nav-tab-content\">\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade show active\" id=\"fdebca\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-js\" id=\"5b03eec\" tabindex=\"0\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createClient <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/supabase-js'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> setupSupabaseHelpers <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> dev <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$app/environment'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> env <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$env/dynamic/public'</span>\n<span class=\"token comment\">// or use the static env</span>\n\n<span class=\"token comment\">// import { PUBLIC_SUPABASE_URL, PUBLIC_SUPABASE_ANON_KEY } from '$env/static/public';</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> supabaseClient <span class=\"token operator\">=</span> <span class=\"token function\">createClient</span><span class=\"token punctuation\">(</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PUBLIC_SUPABASE_URL</span><span class=\"token punctuation\">,</span> env<span class=\"token punctuation\">.</span><span class=\"token constant\">PUBLIC_SUPABASE_ANON_KEY</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">persistSession</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">autoRefreshToken</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">setupSupabaseHelpers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  supabaseClient<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">cookieOptions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">secure</span><span class=\"token operator\">:</span> <span class=\"token operator\">!</span>dev<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade\" id=\"afdbec\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-js\" id=\"46a9076\" tabindex=\"0\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createClient <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> env <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$env/dynamic/public'</span>\n<span class=\"token comment\">// or use the static env</span>\n\n<span class=\"token comment\">// import { PUBLIC_SUPABASE_URL, PUBLIC_SUPABASE_ANON_KEY } from '$env/static/public';</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> supabaseClient <span class=\"token operator\">=</span> <span class=\"token function\">createClient</span><span class=\"token punctuation\">(</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PUBLIC_SUPABASE_URL</span><span class=\"token punctuation\">,</span> env<span class=\"token punctuation\">.</span><span class=\"token constant\">PUBLIC_SUPABASE_ANON_KEY</span><span class=\"token punctuation\">)</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n</div>\n<h3 id=\"migration-initialize-client\">初始化客户端 <a aria-hidden=\"true\" class=\"anchor\" href=\"#migration-initialize-client\"><i class=\"material-icons align-middle\">link</i></a></h3>\n\n<div class=\"tab-content\" id=\"nav-tab-content\">\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade show active\" id=\"abedfc\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-html\" id=\"8ea8db4\" tabindex=\"0\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ts<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token comment\">// make sure the supabase instance is initialized on the client</span>\n  <span class=\"token keyword\">import</span> <span class=\"token string\">'$lib/db'</span>\n  <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> startSupabaseSessionSync <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span>\n  <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> page <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$app/stores'</span>\n  <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> invalidateAll <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$app/navigation'</span>\n\n  <span class=\"token comment\">// this sets up automatic token refreshing</span>\n  <span class=\"token function\">startSupabaseSessionSync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    page<span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">handleRefresh</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token function\">invalidateAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>slot</span> <span class=\"token punctuation\">/&gt;</span></span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade\" id=\"bdeafc\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-html\" id=\"31ca36e\" tabindex=\"0\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> supabaseClient <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$lib/db'</span>\n  <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> invalidate <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$app/navigation'</span>\n  <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> onMount <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'svelte'</span>\n\n  <span class=\"token function\">onMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> subscription <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> supabaseClient<span class=\"token punctuation\">.</span>auth<span class=\"token punctuation\">.</span><span class=\"token function\">onAuthStateChange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">invalidate</span><span class=\"token punctuation\">(</span><span class=\"token string\">'supabase:auth'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      subscription<span class=\"token punctuation\">.</span><span class=\"token function\">unsubscribe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>slot</span> <span class=\"token punctuation\">/&gt;</span></span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n</div>\n<h3 id=\"migration-set-up-hooks\">设置挂钩 <a aria-hidden=\"true\" class=\"anchor\" href=\"#migration-set-up-hooks\"><i class=\"material-icons align-middle\">link</i></a></h3>\n\n<div class=\"tab-content\" id=\"nav-tab-content\">\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade show active\" id=\"bdcfae\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"2c62bab\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token comment\">// make sure the supabase instance is initialized on the server</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'$lib/db'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> dev <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$app/environment'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> auth <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit/server'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> handle <span class=\"token operator\">=</span> <span class=\"token function\">auth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<p><strong>使用其他句柄方法的可选</strong><em>if</em></p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"76b1059\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token comment\">// make sure the supabase instance is initialized on the server</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'$lib/db'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> dev <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$app/environment'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> auth <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit/server'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> sequence <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@sveltejs/kit/hooks'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> handle <span class=\"token operator\">=</span> <span class=\"token function\">sequence</span><span class=\"token punctuation\">(</span><span class=\"token function\">auth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> yourHandler<span class=\"token punctuation\">)</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade\" id=\"acedbf\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"97fbb8b\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token comment\">// make sure the supabase instance is initialized on the server</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'$lib/db'</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"415838a\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token comment\">// make sure the supabase instance is initialized on the client</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'$lib/db'</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n</div>\n<h3 id=\"migration-typings\">键入 <a aria-hidden=\"true\" class=\"anchor\" href=\"#migration-typings\"><i class=\"material-icons align-middle\">link</i></a></h3>\n\n<div class=\"tab-content\" id=\"nav-tab-content\">\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade show active\" id=\"dbcafe\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"81ef842\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token comment\">/// &lt;reference types=\"@sveltejs/kit\" /&gt;</span>\n\n<span class=\"token comment\">// See https://kit.svelte.dev/docs/types#app</span>\n<span class=\"token comment\">// for information about these interfaces</span>\n<span class=\"token comment\">// and what to do when importing types</span>\n<span class=\"token keyword\">declare</span> <span class=\"token keyword\">namespace</span> App <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Locals</span> <span class=\"token punctuation\">{</span>\n    session<span class=\"token operator\">:</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>SupabaseSession\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">interface</span> <span class=\"token class-name\">PageData</span> <span class=\"token punctuation\">{</span>\n    session<span class=\"token operator\">:</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>SupabaseSession\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// interface Error {}</span>\n  <span class=\"token comment\">// interface Platform {}</span>\n<span class=\"token punctuation\">}</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade\" id=\"bfeadc\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"c196d38\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token comment\">/// &lt;reference types=\"@sveltejs/kit\" /&gt;</span>\n\n<span class=\"token comment\">// See https://kit.svelte.dev/docs/types#app</span>\n<span class=\"token comment\">// for information about these interfaces</span>\n<span class=\"token comment\">// and what to do when importing types</span>\n<span class=\"token keyword\">declare</span> <span class=\"token keyword\">namespace</span> App <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Supabase</span> <span class=\"token punctuation\">{</span>\n    Database<span class=\"token operator\">:</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./DatabaseDefinitions'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Database\n    SchemaName<span class=\"token operator\">:</span> <span class=\"token string\">'public'</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// interface Locals {}</span>\n  <span class=\"token keyword\">interface</span> <span class=\"token class-name\">PageData</span> <span class=\"token punctuation\">{</span>\n    session<span class=\"token operator\">:</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>SupabaseSession\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// interface Error {}</span>\n  <span class=\"token comment\">// interface Platform {}</span>\n<span class=\"token punctuation\">}</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n</div>\n<h3 id=\"migration-with-page-auth\">withPageAuth <a aria-hidden=\"true\" class=\"anchor\" href=\"#migration-with-page-auth\"><i class=\"material-icons align-middle\">link</i></a></h3>\n\n<div class=\"tab-content\" id=\"nav-tab-content\">\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade show active\" id=\"cbdfea\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-html\" id=\"b405a11\" tabindex=\"0\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ts<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token keyword\">import</span> type <span class=\"token punctuation\">{</span> PageData <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./$types'</span>\n\n  <span class=\"token keyword\">export</span> <span class=\"token keyword\">let</span> <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> PageData\n  <span class=\"token literal-property property\">$</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> tableData<span class=\"token punctuation\">,</span> user <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> data<span class=\"token punctuation\">)</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span>Protected content for {user.email}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">&gt;</span></span>server-side fetched data with RLS:<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pre</span><span class=\"token punctuation\">&gt;</span></span>{JSON.stringify(tableData, null, 2)}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pre</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">&gt;</span></span>user:<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pre</span><span class=\"token punctuation\">&gt;</span></span>{JSON.stringify(user, null, 2)}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pre</span><span class=\"token punctuation\">&gt;</span></span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"e4e4ad1\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> withAuth <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> redirect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@sveltejs/kit'</span>\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">type</span> <span class=\"token punctuation\">{</span> PageLoad <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./$types'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> load<span class=\"token operator\">:</span> PageLoad <span class=\"token operator\">=</span> <span class=\"token function\">withAuth</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> session<span class=\"token punctuation\">,</span> getSupabaseClient <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>session<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span><span class=\"token number\">303</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data<span class=\"token operator\">:</span> tableData <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getSupabaseClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">'*'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> tableData<span class=\"token punctuation\">,</span> user<span class=\"token operator\">:</span> session<span class=\"token punctuation\">.</span>user <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade\" id=\"fabdce\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-html\" id=\"eb6be29\" tabindex=\"0\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token comment\">/** @type {import('./$types').PageData} */</span>\n  <span class=\"token keyword\">export</span> <span class=\"token keyword\">let</span> data\n  <span class=\"token literal-property property\">$</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> user<span class=\"token punctuation\">,</span> tableData <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> data<span class=\"token punctuation\">)</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span>Protected content for {user.email}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pre</span><span class=\"token punctuation\">&gt;</span></span>{JSON.stringify(tableData, null, 2)}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pre</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pre</span><span class=\"token punctuation\">&gt;</span></span>{JSON.stringify(user, null, 2)}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pre</span><span class=\"token punctuation\">&gt;</span></span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"d1c9a84\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token comment\">// src/routes/profile/+page.ts</span>\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">type</span> <span class=\"token punctuation\">{</span> PageLoad <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./$types'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getSupabase <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> redirect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@sveltejs/kit'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> load<span class=\"token operator\">:</span> <span class=\"token function-variable function\">PageLoad</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> session<span class=\"token punctuation\">,</span> supabaseClient <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getSupabase</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>session<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span><span class=\"token number\">303</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data<span class=\"token operator\">:</span> tableData <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> supabaseClient<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">'*'</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    user<span class=\"token operator\">:</span> session<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">,</span>\n    tableData<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n</div>\n<h3 id=\"migration-with-api-auth\">withApiAuth <a aria-hidden=\"true\" class=\"anchor\" href=\"#migration-with-api-auth\"><i class=\"material-icons align-middle\">link</i></a></h3>\n\n<div class=\"tab-content\" id=\"nav-tab-content\">\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade show active\" id=\"deafcb\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"1bbdf07\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token keyword\">type</span> <span class=\"token punctuation\">{</span> RequestHandler <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./$types'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> withAuth <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> json<span class=\"token punctuation\">,</span> redirect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@sveltejs/kit'</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">TestTable</span> <span class=\"token punctuation\">{</span>\n  id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n  created_at<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">GET</span><span class=\"token operator\">:</span> RequestHandler <span class=\"token operator\">=</span> <span class=\"token function\">withAuth</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> session<span class=\"token punctuation\">,</span> getSupabaseClient <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>session<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span><span class=\"token number\">303</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getSupabaseClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">from</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>TestTable<span class=\"token operator\">&gt;</span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">'*'</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade\" id=\"cabefd\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"5e5f2b6\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token keyword\">type</span> <span class=\"token punctuation\">{</span> RequestHandler <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./$types'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getSupabase <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> json<span class=\"token punctuation\">,</span> redirect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@sveltejs/kit'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">GET</span><span class=\"token operator\">:</span> <span class=\"token function-variable function\">RequestHandler</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> session<span class=\"token punctuation\">,</span> supabaseClient <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getSupabase</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>session<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span><span class=\"token number\">303</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> supabaseClient<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">'*'</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n</div>\n<h2 id=\"migration-0-7\">从0.6.11及以下迁移到0.7.0 <a aria-hidden=\"true\" class=\"anchor\" href=\"#migration-0-7\"><i class=\"material-icons align-middle\">link</i></a></h2><p>此库的最新0.7.0版本中有许多突破性的更改。</p>\n<h3 id=\"环境变量前缀\">环境变量前缀 <a aria-hidden=\"true\" class=\"anchor\" href=\"#%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f%e5%89%8d%e7%bc%80\"><i class=\"material-icons align-middle\">link</i></a></h3><p>环境变量前缀现在是<code>PUBLIC_</code>而不是<code>VITE_</code>（例如，<code>VITE_SUPABASE_URL</code>现在是<code>BUBLIC_SUPABASE_URL</code>）。</p>\n<h3 id=\"migration-set-up-supabase-client-0-7\">设置Supabase客户端 <a aria-hidden=\"true\" class=\"anchor\" href=\"#migration-set-up-supabase-client-0-7\"><i class=\"material-icons align-middle\">link</i></a></h3>\n\n<div class=\"tab-content\" id=\"nav-tab-content\">\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade show active\" id=\"fdeabc\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-js\" id=\"a1df91f\" tabindex=\"0\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createSupabaseClient <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> supabaseClient <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">createSupabaseClient</span><span class=\"token punctuation\">(</span>\n  <span class=\"token keyword\">import</span><span class=\"token punctuation\">.</span>meta<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">VITE_SUPABASE_URL</span> <span class=\"token keyword\">as</span> string<span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">import</span><span class=\"token punctuation\">.</span>meta<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">VITE_SUPABASE_ANON_KEY</span> <span class=\"token keyword\">as</span> string\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token punctuation\">{</span> supabaseClient <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade\" id=\"dbcaef\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-js\" id=\"5b03eec\" tabindex=\"0\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createClient <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/supabase-js'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> setupSupabaseHelpers <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> dev <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$app/environment'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> env <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$env/dynamic/public'</span>\n<span class=\"token comment\">// or use the static env</span>\n\n<span class=\"token comment\">// import { PUBLIC_SUPABASE_URL, PUBLIC_SUPABASE_ANON_KEY } from '$env/static/public';</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> supabaseClient <span class=\"token operator\">=</span> <span class=\"token function\">createClient</span><span class=\"token punctuation\">(</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PUBLIC_SUPABASE_URL</span><span class=\"token punctuation\">,</span> env<span class=\"token punctuation\">.</span><span class=\"token constant\">PUBLIC_SUPABASE_ANON_KEY</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">persistSession</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">autoRefreshToken</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">setupSupabaseHelpers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  supabaseClient<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">cookieOptions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">secure</span><span class=\"token operator\">:</span> <span class=\"token operator\">!</span>dev<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n</div>\n<h3 id=\"migration-initialize-client-0-7\">初始化客户端 <a aria-hidden=\"true\" class=\"anchor\" href=\"#migration-initialize-client-0-7\"><i class=\"material-icons align-middle\">link</i></a></h3>\n\n<div class=\"tab-content\" id=\"nav-tab-content\">\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade show active\" id=\"dcafbe\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-html\" id=\"9857471\" tabindex=\"0\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> session <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$app/stores'</span>\n  <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> supabaseClient <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$lib/db'</span>\n  <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> SupaAuthHelper <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-svelte'</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>SupaAuthHelper</span> <span class=\"token attr-name\">{supabaseClient}</span> <span class=\"token attr-name\">{session}</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>slot</span> <span class=\"token punctuation\">/&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>SupaAuthHelper</span><span class=\"token punctuation\">&gt;</span></span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade\" id=\"dbecaf\" role=\"tabpanel\">\n<p>不再需要<code>@supabase/auth-helpers-svelte</code>库，因为 <code>@supabase/auth-helpers-sveltekit</code> 库处理所有客户端代码。</p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-html\" id=\"8ea8db4\" tabindex=\"0\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ts<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token comment\">// make sure the supabase instance is initialized on the client</span>\n  <span class=\"token keyword\">import</span> <span class=\"token string\">'$lib/db'</span>\n  <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> startSupabaseSessionSync <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span>\n  <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> page <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$app/stores'</span>\n  <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> invalidateAll <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$app/navigation'</span>\n\n  <span class=\"token comment\">// this sets up automatic token refreshing</span>\n  <span class=\"token function\">startSupabaseSessionSync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    page<span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">handleRefresh</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token function\">invalidateAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>slot</span> <span class=\"token punctuation\">/&gt;</span></span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n</div>\n<h3 id=\"migration-set-up-hooks-0-7\">设置挂钩 <a aria-hidden=\"true\" class=\"anchor\" href=\"#migration-set-up-hooks-0-7\"><i class=\"material-icons align-middle\">link</i></a></h3>\n\n<div class=\"tab-content\" id=\"nav-tab-content\">\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade show active\" id=\"afcedb\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"2a7516e\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> handleAuth <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span>\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">type</span> <span class=\"token punctuation\">{</span> GetSession<span class=\"token punctuation\">,</span> Handle <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@sveltejs/kit'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> sequence <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@sveltejs/kit/hooks'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> handle<span class=\"token operator\">:</span> Handle <span class=\"token operator\">=</span> <span class=\"token function\">sequence</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token function\">handleAuth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> getSession<span class=\"token operator\">:</span> <span class=\"token function-variable function\">GetSession</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> user<span class=\"token punctuation\">,</span> accessToken<span class=\"token punctuation\">,</span> error <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span>locals\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    user<span class=\"token punctuation\">,</span>\n    accessToken<span class=\"token punctuation\">,</span>\n    error<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade\" id=\"fabcde\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"2c62bab\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token comment\">// make sure the supabase instance is initialized on the server</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'$lib/db'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> dev <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$app/environment'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> auth <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit/server'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> handle <span class=\"token operator\">=</span> <span class=\"token function\">auth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<p><strong>使用其他句柄方法的可选</strong><em>if</em></p>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"76b1059\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token comment\">// make sure the supabase instance is initialized on the server</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'$lib/db'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> dev <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$app/environment'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> auth <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit/server'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> sequence <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@sveltejs/kit/hooks'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> handle <span class=\"token operator\">=</span> <span class=\"token function\">sequence</span><span class=\"token punctuation\">(</span><span class=\"token function\">auth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> yourHandler<span class=\"token punctuation\">)</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n</div>\n<h3 id=\"migration-typings-0-7\">键入 <a aria-hidden=\"true\" class=\"anchor\" href=\"#migration-typings-0-7\"><i class=\"material-icons align-middle\">link</i></a></h3>\n\n<div class=\"tab-content\" id=\"nav-tab-content\">\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade show active\" id=\"cfaedb\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"2ac0573\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token comment\">/// &lt;reference types=\"@sveltejs/kit\" /&gt;</span>\n<span class=\"token comment\">// See https://kit.svelte.dev/docs/types#app</span>\n<span class=\"token comment\">// for information about these interfaces</span>\n<span class=\"token keyword\">declare</span> <span class=\"token keyword\">namespace</span> App <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserSession</span> <span class=\"token punctuation\">{</span>\n    user<span class=\"token operator\">:</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@supabase/supabase-js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>User\n    accessToken<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Locals</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">UserSession</span> <span class=\"token punctuation\">{</span>\n    error<span class=\"token operator\">:</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@supabase/supabase-js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>ApiError\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Session</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">UserSession</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// interface Platform {}</span>\n  <span class=\"token comment\">// interface Stuff {}</span>\n<span class=\"token punctuation\">}</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade\" id=\"eafdbc\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"81ef842\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token comment\">/// &lt;reference types=\"@sveltejs/kit\" /&gt;</span>\n\n<span class=\"token comment\">// See https://kit.svelte.dev/docs/types#app</span>\n<span class=\"token comment\">// for information about these interfaces</span>\n<span class=\"token comment\">// and what to do when importing types</span>\n<span class=\"token keyword\">declare</span> <span class=\"token keyword\">namespace</span> App <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Locals</span> <span class=\"token punctuation\">{</span>\n    session<span class=\"token operator\">:</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>SupabaseSession\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">interface</span> <span class=\"token class-name\">PageData</span> <span class=\"token punctuation\">{</span>\n    session<span class=\"token operator\">:</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>SupabaseSession\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// interface Error {}</span>\n  <span class=\"token comment\">// interface Platform {}</span>\n<span class=\"token punctuation\">}</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n</div>\n<h3 id=\"检查客户端上的用户\">检查客户端上的用户 <a aria-hidden=\"true\" class=\"anchor\" href=\"#%e6%a3%80%e6%9f%a5%e5%ae%a2%e6%88%b7%e7%ab%af%e4%b8%8a%e7%9a%84%e7%94%a8%e6%88%b7\"><i class=\"material-icons align-middle\">link</i></a></h3>\n\n<div class=\"tab-content\" id=\"nav-tab-content\">\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade show active\" id=\"abfecd\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-html\" id=\"dbaea94\" tabindex=\"0\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> session <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$app/stores'</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n\n{#if !$session.user}\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">&gt;</span></span>I am not logged in<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">&gt;</span></span>\n{:else}\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">&gt;</span></span>Welcome {$session.user.email}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">&gt;</span></span>I am logged in!<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">&gt;</span></span>\n{/if}</code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade\" id=\"dbacef\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-html\" id=\"48231ae\" tabindex=\"0\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> page <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'$app/stores'</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n\n{#if !$page.data.session.user}\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">&gt;</span></span>I am not logged in<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">&gt;</span></span>\n{:else}\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">&gt;</span></span>Welcome {$page.data.session.user.email}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">&gt;</span></span>I am logged in!<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">&gt;</span></span>\n{/if}</code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n</div>\n<h3 id=\"withpageauth\">withPageAuth <a aria-hidden=\"true\" class=\"anchor\" href=\"#withpageauth\"><i class=\"material-icons align-middle\">link</i></a></h3>\n\n<div class=\"tab-content\" id=\"nav-tab-content\">\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade show active\" id=\"eacbdf\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-html\" id=\"eee2664\" tabindex=\"0\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ts<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">context</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>module<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> supabaseServerClient<span class=\"token punctuation\">,</span> withPageAuth <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span>\n  <span class=\"token keyword\">import</span> type <span class=\"token punctuation\">{</span> Load <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./__types/protected-page'</span>\n\n  <span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token literal-property property\">load</span><span class=\"token operator\">:</span> <span class=\"token function-variable function\">Load</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> session <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span>\n    <span class=\"token function\">withPageAuth</span><span class=\"token punctuation\">(</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">redirectTo</span><span class=\"token operator\">:</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">user</span><span class=\"token operator\">:</span> session<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">supabaseServerClient</span><span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">.</span>accessToken<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">'*'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">props</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> data<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">user</span><span class=\"token operator\">:</span> session<span class=\"token punctuation\">.</span>user <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token keyword\">export</span> <span class=\"token keyword\">let</span> data\n  <span class=\"token keyword\">export</span> <span class=\"token keyword\">let</span> user\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span>Protected content for {user.email}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">&gt;</span></span>server-side fetched data with RLS:<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pre</span><span class=\"token punctuation\">&gt;</span></span>{JSON.stringify(data, null, 2)}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pre</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">&gt;</span></span>user:<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pre</span><span class=\"token punctuation\">&gt;</span></span>{JSON.stringify(user, null, 2)}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pre</span><span class=\"token punctuation\">&gt;</span></span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade\" id=\"bedafc\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-html\" id=\"b405a11\" tabindex=\"0\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ts<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token keyword\">import</span> type <span class=\"token punctuation\">{</span> PageData <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./$types'</span>\n\n  <span class=\"token keyword\">export</span> <span class=\"token keyword\">let</span> <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> PageData\n  <span class=\"token literal-property property\">$</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> tableData<span class=\"token punctuation\">,</span> user <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> data<span class=\"token punctuation\">)</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span>Protected content for {user.email}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">&gt;</span></span>server-side fetched data with RLS:<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pre</span><span class=\"token punctuation\">&gt;</span></span>{JSON.stringify(tableData, null, 2)}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pre</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">&gt;</span></span>user:<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pre</span><span class=\"token punctuation\">&gt;</span></span>{JSON.stringify(user, null, 2)}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pre</span><span class=\"token punctuation\">&gt;</span></span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"e4e4ad1\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> withAuth <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> redirect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@sveltejs/kit'</span>\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">type</span> <span class=\"token punctuation\">{</span> PageLoad <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./$types'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> load<span class=\"token operator\">:</span> PageLoad <span class=\"token operator\">=</span> <span class=\"token function\">withAuth</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> session<span class=\"token punctuation\">,</span> getSupabaseClient <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>session<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span><span class=\"token number\">303</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data<span class=\"token operator\">:</span> tableData <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getSupabaseClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">'*'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> tableData<span class=\"token punctuation\">,</span> user<span class=\"token operator\">:</span> session<span class=\"token punctuation\">.</span>user <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n</div>\n<h3 id=\"withapiauth\">withApiAuth <a aria-hidden=\"true\" class=\"anchor\" href=\"#withapiauth\"><i class=\"material-icons align-middle\">link</i></a></h3>\n\n<div class=\"tab-content\" id=\"nav-tab-content\">\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade show active\" id=\"fedcab\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"ea468dc\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> supabaseServerClient<span class=\"token punctuation\">,</span> withApiAuth <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span>\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">type</span> <span class=\"token punctuation\">{</span> RequestHandler <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./__types/protected-route'</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">TestTable</span> <span class=\"token punctuation\">{</span>\n  id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n  created_at<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">GetOutput</span> <span class=\"token punctuation\">{</span>\n  data<span class=\"token operator\">:</span> TestTable<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">GET</span><span class=\"token operator\">:</span> RequestHandler<span class=\"token operator\">&lt;</span>GetOutput<span class=\"token operator\">&gt;</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> locals<span class=\"token punctuation\">,</span> request <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span>\n  <span class=\"token function\">withApiAuth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> user<span class=\"token operator\">:</span> locals<span class=\"token punctuation\">.</span>user <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Run queries with RLS on the server</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">supabaseServerClient</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">'*'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      status<span class=\"token operator\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span>\n      body<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n<div aria-labelledby=\"nav-1\" class=\"tab-pane fade\" id=\"fedabc\" role=\"tabpanel\">\n<div class=\"prism-codeblock\">\n<div class=\"code-toolbar\"><pre class=\"language-ts\" id=\"a1f51bc\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token keyword\">type</span> <span class=\"token punctuation\">{</span> RequestHandler <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./$types'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> withAuth <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@supabase/auth-helpers-sveltekit'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> json<span class=\"token punctuation\">,</span> redirect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@sveltejs/kit'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">TestTable</span> <span class=\"token punctuation\">{</span>\n  id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  created_at<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">GET</span><span class=\"token operator\">:</span> RequestHandler <span class=\"token operator\">=</span> <span class=\"token function\">withAuth</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> session<span class=\"token punctuation\">,</span> getSupabaseClient <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>session<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span><span class=\"token number\">303</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getSupabaseClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">from</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>TestTable<span class=\"token operator\">&gt;</span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">'*'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre><div class=\"toolbar\"><div class=\"toolbar-item\"><button aria-label=\"copy\" class=\"copy-to-clipboard-button\" data-copy-state=\"copy\" type=\"button\"><span></span></button></div></div></div>\n</div>\n</div>\n</div>\n<h2 id=\"其他链接\">其他链接 <a aria-hidden=\"true\" class=\"anchor\" href=\"#%e5%85%b6%e4%bb%96%e9%93%be%e6%8e%a5\"><i class=\"material-icons align-middle\">link</i></a></h2><ul>\n<li><a href=\"https://github.com/supabase/auth-helpers\" rel=\"external\" target=\"_blank\">身份验证帮助程序源代码<svg height=\"16\" viewbox=\"0 0 24 24\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M14 5c-.552 0-1-.448-1-1s.448-1 1-1h6c.552 0 1 .448 1 1v6c0 .552-.448 1-1 1s-1-.448-1-1v-3.586l-7.293 7.293c-.391.39-1.024.39-1.414 0-.391-.391-.391-1.024 0-1.414l7.293-7.293h-3.586zm-9 2c-.552 0-1 .448-1 1v11c0 .552.448 1 1 1h11c.552 0 1-.448 1-1v-4.563c0-.552.448-1 1-1s1 .448 1 1v4.563c0 1.657-1.343 3-3 3h-11c-1.657 0-3-1.343-3-3v-11c0-1.657 1.343-3 3-3h4.563c.552 0 1 .448 1 1s-.448 1-1 1h-4.563z\" fill=\"currentColor\"></path></svg></a></li>\n<li><a href=\"https://github.com/supabase/auth-helpers/tree/main/examples/sveltekit\" rel=\"external\" target=\"_blank\">SveltKit示例<svg height=\"16\" viewbox=\"0 0 24 24\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M14 5c-.552 0-1-.448-1-1s.448-1 1-1h6c.552 0 1 .448 1 1v6c0 .552-.448 1-1 1s-1-.448-1-1v-3.586l-7.293 7.293c-.391.39-1.024.39-1.414 0-.391-.391-.391-1.024 0-1.414l7.293-7.293h-3.586zm-9 2c-.552 0-1 .448-1 1v11c0 .552.448 1 1 1h11c.552 0 1-.448 1-1v-4.563c0-.552.448-1 1-1s1 .448 1 1v4.563c0 1.657-1.343 3-3 3h-11c-1.657 0-3-1.343-3-3v-11c0-1.657 1.343-3 3-3h4.563c.552 0 1 .448 1 1s-.448 1-1 1h-4.563z\" fill=\"currentColor\"></path></svg></a></li>\n<li><a href=\"https://github.com/supabase/auth-helpers/tree/main/examples/sveltekit-email-password\" rel=\"external\" target=\"_blank\">SveltKit电子邮件/密码示例<svg height=\"16\" viewbox=\"0 0 24 24\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M14 5c-.552 0-1-.448-1-1s.448-1 1-1h6c.552 0 1 .448 1 1v6c0 .552-.448 1-1 1s-1-.448-1-1v-3.586l-7.293 7.293c-.391.39-1.024.39-1.414 0-.391-.391-.391-1.024 0-1.414l7.293-7.293h-3.586zm-9 2c-.552 0-1 .448-1 1v11c0 .552.448 1 1 1h11c.552 0 1-.448 1-1v-4.563c0-.552.448-1 1-1s1 .448 1 1v4.563c0 1.657-1.343 3-3 3h-11c-1.657 0-3-1.343-3-3v-11c0-1.657 1.343-3 3-3h4.563c.552 0 1 .448 1 1s-.448 1-1 1h-4.563z\" fill=\"currentColor\"></path></svg></a></li>\n<li><a href=\"https://github.com/supabase/auth-helpers/tree/main/examples/sveltekit-magic-link\" rel=\"external\" target=\"_blank\">SveltKit Magiclink示例<svg height=\"16\" viewbox=\"0 0 24 24\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M14 5c-.552 0-1-.448-1-1s.448-1 1-1h6c.552 0 1 .448 1 1v6c0 .552-.448 1-1 1s-1-.448-1-1v-3.586l-7.293 7.293c-.391.39-1.024.39-1.414 0-.391-.391-.391-1.024 0-1.414l7.293-7.293h-3.586zm-9 2c-.552 0-1 .448-1 1v11c0 .552.448 1 1 1h11c.552 0 1-.448 1-1v-4.563c0-.552.448-1 1-1s1 .448 1 1v4.563c0 1.657-1.343 3-3 3h-11c-1.657 0-3-1.343-3-3v-11c0-1.657 1.343-3 3-3h4.563c.552 0 1 .448 1 1s-.448 1-1 1h-4.563z\" fill=\"currentColor\"></path></svg></a></li>\n</ul>\n</div>\n</div>\n<div><hr class=\"doc-hr\"/>\n<div class=\"d-print-none\" id=\"doc-nav\">\n<div class=\"row flex-xl-nowrap\">\n<div class=\"col-sm-6 pt-2 doc-next\">\n<a href=\"/docs/app/development_guide/auth/auth-helpers/nextjs/\">\n<div class=\"card h-100 my-1\">\n<div class=\"card-body py-2\">\n<p class=\"card-title fs-5 fw-semibold lh-base mb-0\"><i class=\"material-icons align-middle\">navigate_before</i> 使用Next.js进行Supabase认证</p>\n</div>\n</div>\n</a>\n</div>\n<div class=\"col-sm-6 pt-2 doc-prev\">\n<a class=\"ms-auto\" href=\"/docs/app/development_guide/auth/auth-helpers/remix/\">\n<div class=\"card h-100 my-1 text-end\">\n<div class=\"card-body py-2\">\n<p class=\"card-title fs-5 fw-semibold lh-base mb-0\">Supabase Remix认证 <i class=\"material-icons align-middle\">navigate_next</i></p>\n</div>\n</div>\n</a>\n</div>\n</div>\n</div></div>\n</div>\n</div>\n</div>\n</div>\n\n</main>",
  "markdown": "[MemFireDB备份 6](/)\n\nmenu\n\n[官网](https://memfiredb.com/)\n[论坛](https://community.memfiredb.com/)\n[登录](https://cloud.memfiredb.com/auth/login)\n\nEnable dark mode\n\nEnable light mode\n\n本页\n\n安装\n\n# 使用SveltKit进行Supabase认证\n\n该子模块提供了在[SvelteKit](https://kit.svelte.dev/)中实现用户身份验证的方便助手应用程序。\n\n## 安装 [*link*](#%e5%ae%89%e8%a3%85)\n\n此库支持Node.js`^16.15.0`。\n\n```\nnpm install @supabase/auth-helpers-sveltekit\n```\n\n```\nyarn add @supabase/auth-helpers-sveltekit\n```\n\n## 入门 [*link*](#%e5%85%a5%e9%97%a8)\n\n### 配置 [*link*](#%e9%85%8d%e7%bd%ae)\n\n设置填充环境变量。对于本地开发，您可以将其设置为`.env`文件。参见[示例](https://github.com/supabase/auth-helpers/blob/main/examples/sveltekit/.env.example).\n\n```\n# Find these in your Supabase project settings > API\nPUBLIC_SUPABASE_URL=https://your-project.supabase.co\nPUBLIC_SUPABASE_ANON_KEY=your-anon-key\n```\n\n### 设置Suabase客户端 [*link*](#%e8%ae%be%e7%bd%aesuabase%e5%ae%a2%e6%88%b7%e7%ab%af)\n\n首先创建一个`db.ts`文件，并实例化 `supabaseClient`。\n\n```\nimport { createClient } from '@supabase/auth-helpers-sveltekit'\nimport { env } from '$env/dynamic/public'\n// or use the static env\n// import { PUBLIC_SUPABASE_URL, PUBLIC_SUPABASE_ANON_KEY } from '$env/static/public';\n\nexport const supabaseClient = createClient(env.PUBLIC_SUPABASE_URL, env.PUBLIC_SUPABASE_ANON_KEY)\n```\n\n要确保在服务器和客户端上初始化了客户端，请在`src/hooks.server.js`中包含此文件。js`和`src/hooks.client.js`：\n\n```\nimport '$lib/db'\n```\n\n### 同步页面存储 [*link*](#%e5%90%8c%e6%ad%a5%e9%a1%b5%e9%9d%a2%e5%ad%98%e5%82%a8)\n\n编辑`+layout.svelte`文件并设置客户端。\n\n```\n<script>\n  import { supabaseClient } from '$lib/db'\n  import { invalidate } from '$app/navigation'\n  import { onMount } from 'svelte'\n\n  onMount(() => {\n    const {\n      data: { subscription },\n    } = supabaseClient.auth.onAuthStateChange(() => {\n      invalidate('supabase:auth')\n    })\n\n    return () => {\n      subscription.unsubscribe()\n    }\n  })\n</script>\n\n<slot />\n```\n\n调用 `invalidate('supabase:auth')`时，使用`getSupabase()` 的每个`PageLoad`或 `LayoutLoad`都将更新。\n\n如果某些数据在登录/注销时未更新，则可以返回到 `invalidateAll()`。\n\n### 向客户端发送会话 [*link*](#%e5%90%91%e5%ae%a2%e6%88%b7%e7%ab%af%e5%8f%91%e9%80%81%e4%bc%9a%e8%af%9d)\n\n要使会话对UI（页面、布局）可用，请在根布局服务器加载函数中传递会话：\n\n```\nimport type { LayoutServerLoad } from './$types'\nimport { getServerSession } from '@supabase/auth-helpers-sveltekit'\n\nexport const load: LayoutServerLoad = async (event) => {\n  return {\n    session: await getServerSession(event),\n  }\n}\n```\n\n此外，如果使用`invalidate('supabase:auth')`，则可以创建布局加载函数：\n\n```\nimport type { LayoutLoad } from './$types'\nimport { getSupabase } from '@supabase/auth-helpers-sveltekit'\n\nexport const load: LayoutLoad = async (event) => {\n  const { session } = await getSupabase(event)\n  return { session }\n}\n```\n\n这会减少服务器调用，因为客户端自己管理会话。\n\n### 键入 [*link*](#%e9%94%ae%e5%85%a5)\n\n为了充分利用TypeScript及其智能感知，您应该将我们的类型导入到SveltKit项目附带的`app.d.ts`类型定义文件中。\n\n```\n/// <reference types=\"@sveltejs/kit\" />\n\n// See https://kit.svelte.dev/docs/types#app\n// for information about these interfaces\n// and what to do when importing types\ndeclare namespace App {\n  interface Supabase {\n    Database: import('./DatabaseDefinitions').Database\n    SchemaName: 'public'\n  }\n\n  // interface Locals {}\n  interface PageData {\n    session: import('@supabase/supabase-js').Session | null\n  }\n  // interface Error {}\n  // interface Platform {}\n}\n```\n\n### 基本设置 [*link*](#%e5%9f%ba%e6%9c%ac%e8%ae%be%e7%bd%ae)\n\n现在，您可以通过检查 `$page.data`中的`session`对象来确定用户是否在客户端进行了身份验证。\n\n```\n<script>\n  import { page } from '$app/stores'\n</script>\n\n{#if !$page.data.session}\n<h1>I am not logged in</h1>\n{:else}\n<h1>Welcome {$page.data.session.user.email}</h1>\n<p>I am logged in!</p>\n{/if}\n```\n\n## 使用RLS获取客户端数据 [*link*](#%e4%bd%bf%e7%94%a8rls%e8%8e%b7%e5%8f%96%e5%ae%a2%e6%88%b7%e7%ab%af%e6%95%b0%e6%8d%ae)\n\n为了使[行级别安全](/docs/learn/auth-deep-dive/auth-row-level-security)在客户端获取数据时正常工作，您需要确保从 `$lib/db`导入 `{ supabaseClient }`，并仅在 `$page.data`中定义了客户端会话后才运行查询：\n\n```\n<script>\n  import { supabaseClient } from '$lib/db'\n  import { page } from '$app/stores'\n\n  let loadedData = []\n  async function loadData() {\n    const { data } = await supabaseClient.from('test').select('*').limit(20)\n    loadedData = data\n  }\n\n  $: if ($page.data.session) {\n    loadData()\n  }\n</script>\n\n{#if $page.data.session}\n<p>client-side data fetching with RLS</p>\n<pre>{JSON.stringify(loadedData, null, 2)}</pre>\n{/if}\n```\n\n## 使用RLS获取服务器端数据 [*link*](#%e4%bd%bf%e7%94%a8rls%e8%8e%b7%e5%8f%96%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%ab%af%e6%95%b0%e6%8d%ae)\n\n```\n<script>\n  /** @type {import('./$types').PageData} */\n  export let data\n  $: ({ user, tableData } = data)\n</script>\n\n<div>Protected content for {user.email}</div>\n<pre>{JSON.stringify(tableData, null, 2)}</pre>\n<pre>{JSON.stringify(user, null, 2)}</pre>\n```\n\n要使[row-level security](/docs/learn/auth-deep-dive/auth-row-level-security)在服务器环境中工作，您需要使用 `getSupabase`帮助器来检查用户是否经过身份验证。助手需要 `event` 并返回 `session` 和 `supabaseClient`：\n\n```\nimport type { PageLoad } from './$types'\nimport { getSupabase } from '@supabase/auth-helpers-sveltekit'\nimport { redirect } from '@sveltejs/kit'\n\nexport const load: PageLoad = async (event) => {\n  const { session, supabaseClient } = await getSupabase(event)\n  if (!session) {\n    throw redirect(303, '/')\n  }\n  const { data: tableData } = await supabaseClient.from('test').select('*')\n\n  return {\n    user: session.user,\n    tableData,\n  }\n}\n```\n\n## 保护API路由 [*link*](#%e4%bf%9d%e6%8a%a4api%e8%b7%af%e7%94%b1)\n\n包装API路由以检查用户是否具有有效会话。如果他们未登录，则会话为 `null`。\n\n```\nimport type { RequestHandler } from './$types'\nimport { getSupabase } from '@supabase/auth-helpers-sveltekit'\nimport { json, redirect } from '@sveltejs/kit'\n\nexport const GET: RequestHandler = async (event) => {\n  const { session, supabaseClient } = await getSupabase(event)\n  if (!session) {\n    throw redirect(303, '/')\n  }\n  const { data } = await supabaseClient.from('test').select('*')\n\n  return json({ data })\n}\n```\n\n如果您在没有有效会话cookie的情况下访问`/api/protected-route`，将得到303响应。\n\n## 保护措施 [*link*](#%e4%bf%9d%e6%8a%a4%e6%8e%aa%e6%96%bd)\n\n包装操作以检查用户是否具有有效会话。如果他们未登录，则会话为 `null`。\n\n```\nimport type { Actions } from './$types'\nimport { getSupabase } from '@supabase/auth-helpers-sveltekit'\nimport { error, invalid } from '@sveltejs/kit'\n\nexport const actions: Actions = {\n  createPost: async (event) => {\n    const { request } = event\n    const { session, supabaseClient } = await getSupabase(event)\n    if (!session) {\n      // the user is not signed in\n      throw error(403, { message: 'Unauthorized' })\n    }\n    // we are save, let the user create the post\n    const formData = await request.formData()\n    const content = formData.get('content')\n\n    const { error: createPostError, data: newPost } = await supabaseClient\n      .from('posts')\n      .insert({ content })\n\n    if (createPostError) {\n      return invalid(500, {\n        supabaseErrorMessage: createPostError.message,\n      })\n    }\n    return {\n      newPost,\n    }\n  },\n}\n```\n\n如果您尝试提交带有操作的表单 `?/createPost`如果没有有效的会话cookie，您将得到403错误响应。\n\n## 保存和删除会话 [*link*](#%e4%bf%9d%e5%ad%98%e5%92%8c%e5%88%a0%e9%99%a4%e4%bc%9a%e8%af%9d)\n\n```\nimport type { Actions } from './$types'\nimport { invalid, redirect } from '@sveltejs/kit'\nimport { getSupabase } from '@supabase/auth-helpers-sveltekit'\n\nexport const actions: Actions = {\n  signin: async (event) => {\n    const { request, cookies, url } = event\n    const { session, supabaseClient } = await getSupabase(event)\n    const formData = await request.formData()\n\n    const email = formData.get('email') as string\n    const password = formData.get('password') as string\n\n    const { error } = await supabaseClient.auth.signInWithPassword({\n      email,\n      password,\n    })\n\n    if (error) {\n      if (error instanceof AuthApiError && error.status === 400) {\n        return invalid(400, {\n          error: 'Invalid credentials.',\n          values: {\n            email,\n          },\n        })\n      }\n      return invalid(500, {\n        error: 'Server error. Try again later.',\n        values: {\n          email,\n        },\n      })\n    }\n\n    throw redirect(303, '/dashboard')\n  },\n\n  signout: async (event) => {\n    const { supabaseClient } = await getSupabase(event)\n    await supabaseClient.auth.signOut()\n    throw redirect(303, '/')\n  },\n}\n```\n\n## 保护多条路线 [*link*](#%e4%bf%9d%e6%8a%a4%e5%a4%9a%e6%9d%a1%e8%b7%af%e7%ba%bf)\n\n为了避免在每条路由中写入相同的身份验证逻辑，可以使用句柄钩子同时保护多条路由。\n\n```\nimport type { RequestHandler } from './$types'\nimport { getSupabase } from '@supabase/auth-helpers-sveltekit'\nimport { redirect, error } from '@sveltejs/kit'\n\nexport const handle: Handle = async ({ event, resolve }) => {\n  // protect requests to all routes that start with /protected-routes\n  if (event.url.pathname.startsWith('/protected-routes')) {\n    const { session, supabaseClient } = await getSupabase(event)\n\n    if (!session) {\n      throw redirect(303, '/')\n    }\n  }\n\n  // protect POST requests to all routes that start with /protected-posts\n  if (event.url.pathname.startsWith('/protected-posts') && event.request.method === 'POST') {\n    const { session, supabaseClient } = await getSupabase(event)\n\n    if (!session) {\n      throw error(303, '/')\n    }\n  }\n\n  return resolve(event)\n}\n```\n\n## 从0.7.x迁移到0.8 [*link*](#migration)\n\n### 设置Supabase客户端 [*link*](#migration-set-up-supabase-client)\n\n```\nimport { createClient } from '@supabase/supabase-js'\nimport { setupSupabaseHelpers } from '@supabase/auth-helpers-sveltekit'\nimport { dev } from '$app/environment'\nimport { env } from '$env/dynamic/public'\n// or use the static env\n\n// import { PUBLIC_SUPABASE_URL, PUBLIC_SUPABASE_ANON_KEY } from '$env/static/public';\n\nexport const supabaseClient = createClient(env.PUBLIC_SUPABASE_URL, env.PUBLIC_SUPABASE_ANON_KEY, {\n  persistSession: false,\n  autoRefreshToken: false,\n})\n\nsetupSupabaseHelpers({\n  supabaseClient,\n  cookieOptions: {\n    secure: !dev,\n  },\n})\n```\n\n```\nimport { createClient } from '@supabase/auth-helpers-sveltekit'\nimport { env } from '$env/dynamic/public'\n// or use the static env\n\n// import { PUBLIC_SUPABASE_URL, PUBLIC_SUPABASE_ANON_KEY } from '$env/static/public';\n\nexport const supabaseClient = createClient(env.PUBLIC_SUPABASE_URL, env.PUBLIC_SUPABASE_ANON_KEY)\n```\n\n### 初始化客户端 [*link*](#migration-initialize-client)\n\n```\n<script lang=\"ts\">\n  // make sure the supabase instance is initialized on the client\n  import '$lib/db'\n  import { startSupabaseSessionSync } from '@supabase/auth-helpers-sveltekit'\n  import { page } from '$app/stores'\n  import { invalidateAll } from '$app/navigation'\n\n  // this sets up automatic token refreshing\n  startSupabaseSessionSync({\n    page,\n    handleRefresh: () => invalidateAll(),\n  })\n</script>\n\n<slot />\n```\n\n```\n<script>\n  import { supabaseClient } from '$lib/db'\n  import { invalidate } from '$app/navigation'\n  import { onMount } from 'svelte'\n\n  onMount(() => {\n    const {\n      data: { subscription },\n    } = supabaseClient.auth.onAuthStateChange(() => {\n      invalidate('supabase:auth')\n    })\n\n    return () => {\n      subscription.unsubscribe()\n    }\n  })\n</script>\n\n<slot />\n```\n\n### 设置挂钩 [*link*](#migration-set-up-hooks)\n\n```\n// make sure the supabase instance is initialized on the server\nimport '$lib/db'\nimport { dev } from '$app/environment'\nimport { auth } from '@supabase/auth-helpers-sveltekit/server'\n\nexport const handle = auth()\n```\n\n**使用其他句柄方法的可选***if*\n\n```\n// make sure the supabase instance is initialized on the server\nimport '$lib/db'\nimport { dev } from '$app/environment'\nimport { auth } from '@supabase/auth-helpers-sveltekit/server'\nimport { sequence } from '@sveltejs/kit/hooks'\n\nexport const handle = sequence(auth(), yourHandler)\n```\n\n```\n// make sure the supabase instance is initialized on the server\nimport '$lib/db'\n```\n\n```\n// make sure the supabase instance is initialized on the client\nimport '$lib/db'\n```\n\n### 键入 [*link*](#migration-typings)\n\n```\n/// <reference types=\"@sveltejs/kit\" />\n\n// See https://kit.svelte.dev/docs/types#app\n// for information about these interfaces\n// and what to do when importing types\ndeclare namespace App {\n  interface Locals {\n    session: import('@supabase/auth-helpers-sveltekit').SupabaseSession\n  }\n\n  interface PageData {\n    session: import('@supabase/auth-helpers-sveltekit').SupabaseSession\n  }\n\n  // interface Error {}\n  // interface Platform {}\n}\n```\n\n```\n/// <reference types=\"@sveltejs/kit\" />\n\n// See https://kit.svelte.dev/docs/types#app\n// for information about these interfaces\n// and what to do when importing types\ndeclare namespace App {\n  interface Supabase {\n    Database: import('./DatabaseDefinitions').Database\n    SchemaName: 'public'\n  }\n\n  // interface Locals {}\n  interface PageData {\n    session: import('@supabase/auth-helpers-sveltekit').SupabaseSession\n  }\n  // interface Error {}\n  // interface Platform {}\n}\n```\n\n### withPageAuth [*link*](#migration-with-page-auth)\n\n```\n<script lang=\"ts\">\n  import type { PageData } from './$types'\n\n  export let data: PageData\n  $: ({ tableData, user } = data)\n</script>\n\n<div>Protected content for {user.email}</div>\n<p>server-side fetched data with RLS:</p>\n<pre>{JSON.stringify(tableData, null, 2)}</pre>\n<p>user:</p>\n<pre>{JSON.stringify(user, null, 2)}</pre>\n```\n\n```\nimport { withAuth } from '@supabase/auth-helpers-sveltekit'\nimport { redirect } from '@sveltejs/kit'\nimport type { PageLoad } from './$types'\n\nexport const load: PageLoad = withAuth(async ({ session, getSupabaseClient }) => {\n  if (!session.user) {\n    throw redirect(303, '/')\n  }\n\n  const { data: tableData } = await getSupabaseClient().from('test').select('*')\n  return { tableData, user: session.user }\n})\n```\n\n```\n<script>\n  /** @type {import('./$types').PageData} */\n  export let data\n  $: ({ user, tableData } = data)\n</script>\n\n<div>Protected content for {user.email}</div>\n<pre>{JSON.stringify(tableData, null, 2)}</pre>\n<pre>{JSON.stringify(user, null, 2)}</pre>\n```\n\n```\n// src/routes/profile/+page.ts\nimport type { PageLoad } from './$types'\nimport { getSupabase } from '@supabase/auth-helpers-sveltekit'\nimport { redirect } from '@sveltejs/kit'\n\nexport const load: PageLoad = async (event) => {\n  const { session, supabaseClient } = await getSupabase(event)\n  if (!session) {\n    throw redirect(303, '/')\n  }\n  const { data: tableData } = await supabaseClient.from('test').select('*')\n\n  return {\n    user: session.user,\n    tableData,\n  }\n}\n```\n\n### withApiAuth [*link*](#migration-with-api-auth)\n\n```\nimport type { RequestHandler } from './$types'\nimport { withAuth } from '@supabase/auth-helpers-sveltekit'\nimport { json, redirect } from '@sveltejs/kit'\n\ninterface TestTable {\n  id: string\n  created_at: string\n}\n\nexport const GET: RequestHandler = withAuth(async ({ session, getSupabaseClient }) => {\n  if (!session.user) {\n    throw redirect(303, '/')\n  }\n\n  const { data } = await getSupabaseClient().from<TestTable>('test').select('*')\n\n  return json({ data })\n})\n```\n\n```\nimport type { RequestHandler } from './$types'\nimport { getSupabase } from '@supabase/auth-helpers-sveltekit'\nimport { json, redirect } from '@sveltejs/kit'\n\nexport const GET: RequestHandler = async (event) => {\n  const { session, supabaseClient } = await getSupabase(event)\n  if (!session) {\n    throw redirect(303, '/')\n  }\n  const { data } = await supabaseClient.from('test').select('*')\n\n  return json({ data })\n}\n```\n\n## 从0.6.11及以下迁移到0.7.0 [*link*](#migration-0-7)\n\n此库的最新0.7.0版本中有许多突破性的更改。\n\n### 环境变量前缀 [*link*](#%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f%e5%89%8d%e7%bc%80)\n\n环境变量前缀现在是`PUBLIC_`而不是`VITE_`（例如，`VITE_SUPABASE_URL`现在是`BUBLIC_SUPABASE_URL`）。\n\n### 设置Supabase客户端 [*link*](#migration-set-up-supabase-client-0-7)\n\n```\nimport { createSupabaseClient } from '@supabase/auth-helpers-sveltekit';\n\nconst { supabaseClient } = createSupabaseClient(\n  import.meta.env.VITE_SUPABASE_URL as string,\n  import.meta.env.VITE_SUPABASE_ANON_KEY as string\n);\n\nexport { supabaseClient };\n```\n\n```\nimport { createClient } from '@supabase/supabase-js'\nimport { setupSupabaseHelpers } from '@supabase/auth-helpers-sveltekit'\nimport { dev } from '$app/environment'\nimport { env } from '$env/dynamic/public'\n// or use the static env\n\n// import { PUBLIC_SUPABASE_URL, PUBLIC_SUPABASE_ANON_KEY } from '$env/static/public';\n\nexport const supabaseClient = createClient(env.PUBLIC_SUPABASE_URL, env.PUBLIC_SUPABASE_ANON_KEY, {\n  persistSession: false,\n  autoRefreshToken: false,\n})\n\nsetupSupabaseHelpers({\n  supabaseClient,\n  cookieOptions: {\n    secure: !dev,\n  },\n})\n```\n\n### 初始化客户端 [*link*](#migration-initialize-client-0-7)\n\n```\n<script>\n  import { session } from '$app/stores'\n  import { supabaseClient } from '$lib/db'\n  import { SupaAuthHelper } from '@supabase/auth-helpers-svelte'\n</script>\n\n<SupaAuthHelper {supabaseClient} {session}>\n  <slot />\n</SupaAuthHelper>\n```\n\n不再需要`@supabase/auth-helpers-svelte`库，因为 `@supabase/auth-helpers-sveltekit` 库处理所有客户端代码。\n\n```\n<script lang=\"ts\">\n  // make sure the supabase instance is initialized on the client\n  import '$lib/db'\n  import { startSupabaseSessionSync } from '@supabase/auth-helpers-sveltekit'\n  import { page } from '$app/stores'\n  import { invalidateAll } from '$app/navigation'\n\n  // this sets up automatic token refreshing\n  startSupabaseSessionSync({\n    page,\n    handleRefresh: () => invalidateAll(),\n  })\n</script>\n\n<slot />\n```\n\n### 设置挂钩 [*link*](#migration-set-up-hooks-0-7)\n\n```\nimport { handleAuth } from '@supabase/auth-helpers-sveltekit'\nimport type { GetSession, Handle } from '@sveltejs/kit'\nimport { sequence } from '@sveltejs/kit/hooks'\n\nexport const handle: Handle = sequence(...handleAuth())\n\nexport const getSession: GetSession = async (event) => {\n  const { user, accessToken, error } = event.locals\n  return {\n    user,\n    accessToken,\n    error,\n  }\n}\n```\n\n```\n// make sure the supabase instance is initialized on the server\nimport '$lib/db'\nimport { dev } from '$app/environment'\nimport { auth } from '@supabase/auth-helpers-sveltekit/server'\n\nexport const handle = auth()\n```\n\n**使用其他句柄方法的可选***if*\n\n```\n// make sure the supabase instance is initialized on the server\nimport '$lib/db'\nimport { dev } from '$app/environment'\nimport { auth } from '@supabase/auth-helpers-sveltekit/server'\nimport { sequence } from '@sveltejs/kit/hooks'\n\nexport const handle = sequence(auth(), yourHandler)\n```\n\n### 键入 [*link*](#migration-typings-0-7)\n\n```\n/// <reference types=\"@sveltejs/kit\" />\n// See https://kit.svelte.dev/docs/types#app\n// for information about these interfaces\ndeclare namespace App {\n  interface UserSession {\n    user: import('@supabase/supabase-js').User\n    accessToken?: string\n  }\n\n  interface Locals extends UserSession {\n    error: import('@supabase/supabase-js').ApiError\n  }\n\n  interface Session extends UserSession {}\n\n  // interface Platform {}\n  // interface Stuff {}\n}\n```\n\n```\n/// <reference types=\"@sveltejs/kit\" />\n\n// See https://kit.svelte.dev/docs/types#app\n// for information about these interfaces\n// and what to do when importing types\ndeclare namespace App {\n  interface Locals {\n    session: import('@supabase/auth-helpers-sveltekit').SupabaseSession\n  }\n\n  interface PageData {\n    session: import('@supabase/auth-helpers-sveltekit').SupabaseSession\n  }\n\n  // interface Error {}\n  // interface Platform {}\n}\n```\n\n### 检查客户端上的用户 [*link*](#%e6%a3%80%e6%9f%a5%e5%ae%a2%e6%88%b7%e7%ab%af%e4%b8%8a%e7%9a%84%e7%94%a8%e6%88%b7)\n\n```\n<script>\n  import { session } from '$app/stores'\n</script>\n\n{#if !$session.user}\n<h1>I am not logged in</h1>\n{:else}\n<h1>Welcome {$session.user.email}</h1>\n<p>I am logged in!</p>\n{/if}\n```\n\n```\n<script>\n  import { page } from '$app/stores'\n</script>\n\n{#if !$page.data.session.user}\n<h1>I am not logged in</h1>\n{:else}\n<h1>Welcome {$page.data.session.user.email}</h1>\n<p>I am logged in!</p>\n{/if}\n```\n\n### withPageAuth [*link*](#withpageauth)\n\n```\n<script lang=\"ts\" context=\"module\">\n  import { supabaseServerClient, withPageAuth } from '@supabase/auth-helpers-sveltekit'\n  import type { Load } from './__types/protected-page'\n\n  export const load: Load = async ({ session }) =>\n    withPageAuth(\n      {\n        redirectTo: '/',\n        user: session.user,\n      },\n      async () => {\n        const { data } = await supabaseServerClient(session.accessToken).from('test').select('*')\n        return { props: { data, user: session.user } }\n      }\n    )\n</script>\n\n<script>\n  export let data\n  export let user\n</script>\n\n<div>Protected content for {user.email}</div>\n<p>server-side fetched data with RLS:</p>\n<pre>{JSON.stringify(data, null, 2)}</pre>\n<p>user:</p>\n<pre>{JSON.stringify(user, null, 2)}</pre>\n```\n\n```\n<script lang=\"ts\">\n  import type { PageData } from './$types'\n\n  export let data: PageData\n  $: ({ tableData, user } = data)\n</script>\n\n<div>Protected content for {user.email}</div>\n<p>server-side fetched data with RLS:</p>\n<pre>{JSON.stringify(tableData, null, 2)}</pre>\n<p>user:</p>\n<pre>{JSON.stringify(user, null, 2)}</pre>\n```\n\n```\nimport { withAuth } from '@supabase/auth-helpers-sveltekit'\nimport { redirect } from '@sveltejs/kit'\nimport type { PageLoad } from './$types'\n\nexport const load: PageLoad = withAuth(async ({ session, getSupabaseClient }) => {\n  if (!session.user) {\n    throw redirect(303, '/')\n  }\n\n  const { data: tableData } = await getSupabaseClient().from('test').select('*')\n  return { tableData, user: session.user }\n})\n```\n\n### withApiAuth [*link*](#withapiauth)\n\n```\nimport { supabaseServerClient, withApiAuth } from '@supabase/auth-helpers-sveltekit'\nimport type { RequestHandler } from './__types/protected-route'\n\ninterface TestTable {\n  id: string\n  created_at: string\n}\n\ninterface GetOutput {\n  data: TestTable[]\n}\n\nexport const GET: RequestHandler<GetOutput> = async ({ locals, request }) =>\n  withApiAuth({ user: locals.user }, async () => {\n    // Run queries with RLS on the server\n    const { data } = await supabaseServerClient(request).from('test').select('*')\n\n    return {\n      status: 200,\n      body: { data },\n    }\n  })\n```\n\n```\nimport type { RequestHandler } from './$types';\nimport { withAuth } from '@supabase/auth-helpers-sveltekit';\nimport { json, redirect } from '@sveltejs/kit';\n\ninterface TestTable {\n  id: string;\n  created_at: string;\n}\n\nexport const GET: RequestHandler = withAuth(async ({ session, getSupabaseClient }) => {\n  if (!session.user) {\n    throw redirect(303, '/');\n  }\n\n  const { data } = await getSupabaseClient()\n    .from<TestTable>('test')\n    .select('*');\n\n  return json({ data });\n);\n```\n\n## 其他链接 [*link*](#%e5%85%b6%e4%bb%96%e9%93%be%e6%8e%a5)\n\n* [身份验证帮助程序源代码](https://github.com/supabase/auth-helpers)\n* [SveltKit示例](https://github.com/supabase/auth-helpers/tree/main/examples/sveltekit)\n* [SveltKit电子邮件/密码示例](https://github.com/supabase/auth-helpers/tree/main/examples/sveltekit-email-password)\n* [SveltKit Magiclink示例](https://github.com/supabase/auth-helpers/tree/main/examples/sveltekit-magic-link)\n\n---\n\n[*navigate\\_before* 使用Next.js进行Supabase认证](/docs/app/development_guide/auth/auth-helpers/nextjs/)\n\n[Supabase Remix认证 *navigate\\_next*](/docs/app/development_guide/auth/auth-helpers/remix/)"
}