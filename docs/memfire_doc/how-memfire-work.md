<!-- memfire-guide.md -->

# MemFire 全景开发指南

> 以「独立站内容系统」为蓝本，沿着「需求→上线→迭代」完整生命周期，
> 解释 **8 大板块存在的意义、带来的便利**，以及 **“如果缺了它们会有多麻烦”**。

---

## 0. TL;DR 导航图

| 生命周期阶段 | 核心痛点               | 救星板块                            | 若无此板块，你将被迫…                  |
| ------------ | ---------------------- | ----------------------------------- | --------------------------------------- |
| 需求评审     | 用户体系、数据模型未定 | **认证 + 数据库**             | 自建登录、自建 MySQL，折腾 2-3 周       |
| 原型开发     | 手写 CRUD & 上传逻辑   | **Serverless API + 对象存储** | 起 Node 服务、接 OSS，再写 500 行代码   |
| 实时协同     | 轮询刷新、冲突覆盖     | **实时数据库**                | 自己上 WebSocket、Redis 队列，运维噩梦  |
| 业务扩展     | 摘要、推荐算法         | **云函数 + AI/Vectors**       | 买 GPU、写 CUDA、配 Faiss，预算翻 10 倍 |
| 上线运维     | 域名、证书、CI/CD      | **静态托管**                  | 买 ECS、配 Nginx、写脚本熬夜到天亮      |

---

## 1. 需求 & 原型阶段

### 1.1 认证板块

- **存在的意义**：把“注册/登录/找回密码/权限”封装成配置项，一行代码即可调用。
- **便利**控制台 → Auth → 勾选 **Phone 验证码**，前端：`supabase.auth.signInWithOtp({ phone })`
- **若无此板块**
  ➜ 自己写短信网关、验证码逻辑、JWT、刷新令牌——**至少 1 周 + 1000 行代码 + 法务合规烦恼**。

### 1.2 数据库板块

- **存在的意义**：在线 SQL 编辑器 + 自动 REST / GraphQL API，无需后端。
- **便利**新建 `posts` 表后，立即获得：`GET /rest/v1/posts?select=*`
- **若无此板块**
  ➜ 起 RDS、写 Prisma schema、起 Node 服务、写 Swagger——**2 周起步，DBA 通宵**。

---

## 2. 本地开发阶段

### 2.1 Serverless API（PostgREST）

- **存在的意义**：把 SQL 表直接映射成 RESTful 端点，支持过滤、分页、关系。
- **便利**前端即取即用：`axios.get('/posts?author_id=eq.123')`
- **若无此板块**
  ➜ 手写 10 个路由、20 个查询参数、再写 Swagger 文档——**开发效率腰斩**。

### 2.2 对象存储

- **存在的意义**：一键上传、自动 CDN、签名直传，省掉“文件服务器”。
- **便利**前端直传：`supabase.storage.from('covers').upload(file.name, file)`
- **若无此板块**
  ➜ 买 OSS、写 STS 签名、配置跨域、写缩略图服务——**3 天变 3 周**。

---

## 3. 实时协同阶段

### 3.1 实时数据库

- **存在的意义**：基于 PostgreSQL WAL 的推送，写 SQL 就能拿到 WebSocket 推送。
- **便利**一行订阅：`supabase.from('posts').on('UPDATE', cb).subscribe()`
- **若无此板块**
  ➜ 自架 Socket.io、Redis、处理重连、冲突合并——**运维+开发双线崩溃**。

---

## 4. 智能业务阶段

### 4.1 云函数（Edge Functions）

- **存在的意义**：无服务器运行 JS/Deno，按调用计费，天然弹性。
- **便利**新建 `generate-summary.ts`，上传即部署，**无需买 ECS**。
- **若无此板块**
  ➜ 起 Docker、K8s、CI/CD、弹性伸缩——**人月神话现场重演**。

### 4.2 AI & Vectors

- **存在的意义**：内置 `pgvector`，SQL 就能做向量检索 + 调用 OpenAI。
- **便利**一条 SQL 完成相似文章：`order by embedding <=> query limit 5`
- **若无此板块**
  ➜ 买 GPU 机器、装 Faiss、写 C++、调 CUDA——**预算从 0 到 5 万**。

---

## 5. 上线 & 运维阶段

### 5.1 静态托管

- **存在的意义**：GitHub 一键部署，自动 HTTPS、CDN、回滚。
- **便利**域名绑定：`blog.acme.com` → 3 分钟完成 SSL。
- **若无此板块**
  ➜ 买域名、申请证书、装 Nginx、写脚本、熬夜值班——**上线日变通宵日**。

---

## 6. 二次迭代阶段

| 新需求                | 组合板块用法                                       | 若无板块的代价                 |
| --------------------- | -------------------------------------------------- | ------------------------------ |
| Markdown 批量导入文章 | 对象存储(上传 zip) + 云函数(解析) + 数据库(upsert) | 自建队列、解析服务、重试机制   |
| A/B 推荐算法          | AI/Vectors(两套 embedding) + 云函数(分桶逻辑)      | 维护两套推荐服务、流量切分脚本 |

---

## 7. 一页速查

| 板块                     | 一句话价值            | 缺了它你要做的事           |
| ------------------------ | --------------------- | -------------------------- |
| **认证**           | “把登录做成开关”    | 自建 OAuth、短信网关、风控 |
| **数据库**         | “写 SQL 就得到 API” | 起 RDS、写后端、写接口文档 |
| **Serverless API** | “表即接口”          | 手写 REST/GraphQL          |
| **云函数**         | “代码即服务”        | 买服务器、配 K8s           |
| **实时数据库**     | “SQL 即 WebSocket”  | Socket.io + Redis          |
| **对象存储**       | “上传即 CDN”        | OSS + 签名 + 缩略图服务    |
| **AI & Vectors**   | “SQL 做向量检索”    | GPU + Faiss + 算法团队     |
| **静态托管**       | “git push 即上线”   | Nginx + 证书 + CI/CD       |

> 把本文件保存在 repo 根目录，团队新人 5 分钟就能理解“为什么选 MemFire，以及不选会多踩多少坑”。
>
